---
title: 【GA4】 Analytics と Google タグマネージャーを連携（画像解説28枚アリ）
date: 2021-06-20
hero: thumbnail/2021/entry474.jpg
pagetype: blog
cateId: 'seo'
tags: ["Web解析"]
description: 先日タグマネージャーとGA4を連携しました。電話発信回数やCVエリアのクリック数を測定したくて設定したのですが、すぐ忘れちゃいそうなのでメモとして記事化しました。よろしければ参考にしてください。
lead: ["先日タグマネージャーとGA4を連携しました。電話発信回数やCVエリアのクリック数を測定したくて設定したのですが、すぐ忘れちゃいそうなのでメモとして記事化しました。よろしければ参考にしてください。"]
---
## この記事の対象

* タグマネージャー初心者
* GA4とタグマネを連携したい
* ユニバーサルアナリティクス（旧：アナリティクス）とタグマネを連携したい
* ユニバーサルアナリティクス（旧：アナリティクス）とタグマネを連携したい

タグマネージャー（通称タグマネ）はサイトが重くなるという理由で今まで使ってませんでした。

計測するものが増え今回思い切ってタグマネに切り替えました。

### タグマネージャーとは？
> タグマネージャーとは、タグを一括で管理するツールのこと。データを取得するためにタグを設置します。

例えば、ボタンなどのクリック数を計測したいなどありますよね？

タグマネージャーを使わない場合、タグはhtmlへ直書き実装します。
```html
<a href="tel:000-0000-0000" onclick="gtag('event', 'click', {'event_category': 'button','event_label': 'tell2'});"><i class="fas fa-phone-volume"></i> 000-0000-0000</a>
```
ちょっとコードを書きなれていない方にはハードルが高いですよね。。。

こんな面倒なコードを書くことなく、タグマネージャーの管理画面からタグを実装できます。

<div class="box"><em>タグマネージャーは計測用のタグを手軽に設置し一元管理できるツール。</em></div>

## タグマネージャーアカウント作成後、コンテナを作る
アカウントを作成し、コンテナを作成します。

![タグマネージャーアカウント作成](./images/2021/06/entry474-1.jpg)

### アカウント作成

* アカウント名 ... 組織名がベストかと
* 国 ... サービスを提供する国で

### コンテナ設定
* コンテナ名 ... サイト名とか
* プラットフォーム ... ブログなどはウェブサイトでOK。特殊じゃない限りこれで大丈夫だと思います。

<br>これでタグマネージャー設置用のコードが発行されます。

タグマネージャーのインストールとは、ようは指定された場所にコードを貼るだけ。

![タグマネージャーアカウント作成](./images/2021/06/entry474-2.jpg)

headタグ内の上部とbody開始タグの直後の2箇所にそれぞれコードを貼り付けます。

```html
<html>
<head>
<!--1個目のコードはできるだけ上の方に設置-->
.
.
.
</head>
<body>
<!--２個目のコードは<body>の直後に-->
.
.
.
```

もしコードを再取得したいときは、タグマネージャーのIDをクリックすると確認可能です。
![タグマネージャーアカウント作成](./images/2021/06/entry474-3.jpg)

<div class="box"><em>WordPressなどのプラグインやテーマによってはタグマネージャーのIDさえあれば設置可能のこともあります。</em></div>

## タグを設置してGAと連携
早速Google Analyticsと連携します。今回はユニバーサルアナリティクス（旧）とGA4（新）の連携方法をご紹介しておきます。

<small>※ 私はユニバーサルアナリティクスとGA4のデータを併用して計測しています。</small>

### ユニバーサルアナリティクスと連携する
タグを追加します。

![タグを追加](./images/2021/06/entry474-0.jpg)

タグの種類からユニバーサルアナリティクスを選択します。トラッキングタイプはページビューでOKです。

![タグの種類からユニバーサルアナリティクスを選択](./images/2021/06/entry474-4.jpg)

Googleアナリティクス設定で新しい変数を定義します（後々イベントトラッキングなどで使用するため）。

![新しい変数を定義します（後々イベントトラッキングなどで使用するため）](./images/2021/06/entry474-6.jpg)

ユニバーサルアナリティクスのトラッキングIDはGoogle Analyticsの管理（歯車マーク）プロパティから確認できます。
![トラッキングコードはGoogle Analyticsの管理（歯車マーク）プロパティから確認](./images/2021/06/entry474-7.jpg)

トラッキングIDをコピーしたら、変数のトラッキングIDに貼り付けます。ユニーバーサルアナリティクスIDとかわかりやすい名前で保存しておきます。

![](./images/2021/06/entry474-5.jpg)

最後にトリガーを設定します。*All Pages*でOKです。

必要であればタグ名を変更して保存します。

![](./images/2021/06/entry474-8.jpg)

タグがきちんと実装できたかは、[タグ発火の確認方法とコンテナ公開](#タグ発火の確認方法とコンテナ公開)を参考にしてください。

### GA4と連携する
次はGA4と連携しましょう。ユニバーサルアナリティクスよりもっとカンタンです。

ただ、トラッキングIDのある場所がややこしいので注意です。<br>
設定（歯車マーク）からプロパティ、データストリームで指定のストリームを選び、詳細の中に測定IDがあります。

![設定（歯車マーク）からプロパティ、データストリームで指定のストリームを選び、詳細の中に測定ID](./images/2021/06/entry474-12.jpg)

タグを追加し、タグの種類を*Googleアナリティクス:GA4*設定にします。

![念の為、アナリティクスの管理画面のリアルタイムで確認](./images/2021/06/entry474-13.jpg)

ユニバーサルアナリティクス同様配信トリガーを*All Pages*に設定したらGA4などわかりやすい名前をつけて保存します。

タグがきちんと実装できたかは、[タグ発火の確認方法とコンテナ公開](#タグ発火の確認方法とコンテナ公開)を参考にしてください。

## タグ発火の確認方法とコンテナ公開
設定したものの、IDの記載ミスなどでタグがうまく動いていないなんてこともあります。

タグがちゃんと発火しているか確認した上でコンテナを公開します。

### タグ発火の確認方法
プレビューをクリックし反映しているか確認します。

![プレビューをクリックし反映しているか確認](./images/2021/06/entry474-10.jpg)

Tag Assistantというツールが別タブで開きます。確認したいサイトのURLを入力し、「Connect」ボタンをクリック。

![](./images/2021/06/entry474-22.jpg)

Continueを押して、全体を確認します。

![](./images/2021/06/entry474-23.jpg)

さらに別タブで対象のサイトが開きます。

![](./images/2021/06/entry474-24.jpg)

*Tags Fired（発火しているタグ）*のなかに設置したタグ名が含まれていればOK!!!

![Tags Fired（発火しているタグ）のなかに設置したタグ名が含まれていればOK](./images/2021/06/entry474-9.jpg)

さらに管理画面からリアルタイムで確認してみます。

![念の為、アナリティクスの管理画面のリアルタイムで確認](./images/2021/06/entry474-11.jpg)

イベントなどのタグは、実際にトリガー（クリックなど）されないと発火しません。なので、Tag Assistantで開いたタブの中で実際トリガーさせてみます。

![](./images/2021/06/entry474-24.jpg)

<div class="box"><em>反応しないときはページをリロードするなどしてみましょう。反映しない場合は拡張機能のオプトアウト、IP除外なども確認してみましょう。</em></div>

### コンテナの公開
コンテナを公開します。

![](./images/2021/06/entry474-25.jpg)

コンテナーはバージョンごとに管理できます。もし「前のバージョンに戻したい！」って時は戻せます。

バージョン名とバージョンの説明はなくても公開できますが、元に戻す可能性があれば書いておいた方が良いです。

![](./images/2021/06/entry474-26.jpg)


## イベントの登録
イベントをタグマネで登録してみましょう！ユニバーサルアナリテティクスとGA4両方紹介します。

今回は、携帯からの電話発信とコンバージョンボタンのクリック数を計測する方法をご紹介します。

### 組み込み変数を設定する（共通）
左のメニューの「変数」から設定を開き、必要な組み込み変数を追加しておきます。

![「変数」から設定を開き、必要な組み込み変数を追加](./images/2021/06/entry474-14.jpg)

|変数|詳細|
|-|-|
|*Click Classes*|クリックされる要素のクラス|
|*Click Element*|クリックされる要素名|
|*Click ID*|クリックされる要素のID|
|*Click Target*|クリックされる要素のtarget属性|
|*Click Text*|クリックされる要素のテキスト|
|*Click URL*|クリックされる要素のURL|

### トリガーを設定する（共通）
携帯からの電話発信とコンバージョンボタンのトリガーを設定します。

どちらもトリガータイプをリンククリックとし一部のリンククリックにチェックします。

![トリガータイプをリンククリックとし一部のリンククリックにチェック](./images/2021/06/entry474-15.jpg)

条件を設定します。タグに含まれるリンクやクラスを組み合わせて、一致する要素のクリックされた時をトリガーとします。<br>条件は「含む」か「一致」でいいと思います。

*電話発信*
![電話発信トリガーの設定](./images/2021/06/entry474-16.jpg)

*CVクリック*
![CVクリックトリガーの設定](./images/2021/06/entry474-17.jpg)


## イベント用タグの登録
イベント用のタグを登録します。

### ユニバーサルアナリティクスでのタグ設定

タグの種類はユニバーサルアナリティク、ストラッキングタイプをイベントに設定します。

|ディメンション名|補足と詳細|
|-|-|
|カテゴリ|イベントのカテゴリ名です。一般的に行為に対する対象物です。|
|アクション|ユーザーのアクション|
|ラベル|計測するデータの最小単位など|

今回2つともボタンなので、カテゴリはbuttonとしました。

Googleアナリティクス設定でトラッキングIDが格納されている変数を選択します。

それぞれトリガーも設定します。

*電話発信*<br>
アクションは*call*、ラベルは場所も取得したかったので、*電話発信:ページパス*としました。

![電話発信](./images/2021/06/entry474-18.jpg)

*CVボタンクリック*<br>
アクションは*click*、ラベルは*サイドバーCVボタン:ページパス*としました。

![電話発信](./images/2021/06/entry474-19.jpg)

[タグ発火の確認方法とコンテナ公開](#タグ発火の確認方法とコンテナ公開)を参考に、プレビューで実際に試してみましょう。

*Tags Fired*にタグが移動したら成功です。

併せてアナリティクス管理画面のリアルタイム>イベントでも確認しましょう。

![電話発信](./images/2021/06/entry474-27.jpg)

<div class="box">
<h4>イベントのカテゴリ・アクション・ラベルを最初インめっちゃ考えておいた方がいい</h4>
CVに至るまでにたくさんイベントを登録するかと思いますが、今回自分のサイトでめちゃ思ったのがイベントのカテゴリ・アクション・ラベルのルールをちゃんと決めてなかったことを反省しました。
</div>

### GA4でのタグ設定
タグの種類を*Google アナリティクス: GA4 イベント*とし、設定タグにトラッキング用で作成したGA4用のタグをセットします。

イベント名とタグ名は間違えそうなので同じにしておくのが良さそうです。

*電話発信GA4*<br>

![電話発信GA4](./images/2021/06/entry474-20.jpg)

*CVボタンクリックGA4*<br>
![電話発信GA4](./images/2021/06/entry474-21.jpg)


![](./images/2021/06/entry474-28.jpg)

## まとめ・GA4とタグマネージャーの連携はカンタン
やってみるとタグマネージャーとGA4の連携はユニバーサルアナリティクスよりもカンタンでした。

私のサイトはついでにHotjar、Adsenseもタグマネから追加しました。一元管理サイコー。

<msg txt="こんなにラクならさっさと導入すればよかった。。。"></msg>

皆さんのSEOライフの一助となれば幸いです。

最後までお読みいただきありがとうございました。
