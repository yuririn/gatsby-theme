---
title: データポータル（データスタジオ）で Search Console と Googleアナリティクス を統合する
date: 2022-05-21
modifieddate: 2022-06-22
pagetype: blog
cateId: seo
hero: thumbnail/2022/entry500.png
tags: ["Web解析","SEOライティング"]
description: Googleデータポータルで Search Console のインプレッション数や アナリティクス のPVを統合したデータの作り方をご紹介します。
lead: ["先日、既存記事をリライトするためにGoogleデータポータルを使ってSearch ConsoleとGoogleのインプレッション数や アナリティクスのPVを合算したデータの表を作りました。","Googleデータポータルはクセがあり複雑な設定があるので、具体的にどう作業してデータを統合したのかをまとめました。","画像多めで詳しく解説しているので、敷居の高いGoogleデータポータルも一人で設定可能です。"]
---
## この記事はこんな方におすすめ
* ブログのリライトをしたいけどどの記事から手を付けていいかわからない
* データポータルを使っててっとり早くWeb解析をしたい
* データポータルを使っていろんなデータを統合してみたい

注意点！今回はユニバーサルアナリティクスを使用しています！後日、GA4版も作成します。

<msg txt="データポータルはビッグクエリなどと連携しない場合は無料で使えます！"></msg>

## 解析対象の記事のURLとタイトルのスプシを準備する
解析対象の記事のスプシを準備します。現在公開中の記事のURLとタイトルを抽出したシートを作りました。

![ローカル側のGraphQLで記事のみ抽出してシート](./images/2022/05/entry500-1.png)

一般の方はWordPressでブログ管理している人が多いと思うので、[WP CSV Exporter](https://wordpress.org/plugins/wp-csv-exporter/)というプラグインを使って出力するのがベストと思います。

私のブログはGatsbyJSでできているのでローカル側のGraphQLで記事のみ抽出してシートを作りました。やり方は、[こちら](/blogs/entry336/#%E7%89%B9%E5%AE%9A%E3%81%AE%E6%96%87%E5%AD%97%E3%81%8C%E5%90%AB%E3%81%BE%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E8%A1%8C%E3%82%92%E5%89%8A%E9%99%A422-05-22)に書いておきましたので興味のある方はお読みください。

## データポータルにアクセス、無料で利用するでスタート
[データポータル](https://marketingplatform.google.com/intl/ja/about/data-studio/)にアクセスし、無料で利用するをクリックします。
![ローカル側のGraphQLで記事のみ抽出してシート](./images/2022/05/entry500-2.jpg)

もしくは、[直接](https://datastudio.google.com/)アクセスしましょう。

### 空のレポートを作成しておく
まずは空のレポートを作成します。

![空のレポートを作成しておく](./images/2022/05/entry500-3.png)
無題のレポートができました。
![空のレポートを作成しておく](./images/2022/05/entry500-4.png)

## データの連携処理
空のレポートからデータの連携処理を行っていきます。

無題のレポートが出来上がりますので編集をクリックします。

### スプレッドシートと連携しておく
まずはスプレッドシートのデータを取り込みます。

![ローカル側のGraphQLで記事のみ抽出してシート](./images/2022/05/entry500-5.png)

データを追加し、必要なスプシとシートを取り込みます。
![ローカル側のGraphQLで記事のみ抽出してシート](./images/2022/05/entry500-7.png)

使用したいスプシを選び、先頭行をヘッダーとして使用するにチェックをし、右下の追加ボタンをクリック。
![ローカル側のGraphQLで記事のみ抽出してシート](./images/2022/05/entry500-6.png)

#### ディメンション設定をしてデータがきちんと取り込めているか確認する

URLとタイトルを表示してみます。

ディメンションにURLとTITLE（先頭行の名称）を選びます。以下のように表示されていれば成功です。

![ディメンション設定](./images/2022/05/entry500-8.png)

### Search Console と連携する
次に、Search Consoleのデータを取り込みます。データの追加を行います。
![ローカル側のGraphQLで記事のみ抽出してシート](./images/2022/05/entry500-5.png)

対象のドメイン、URLのインプレッション、Webを選びます。<br>スクショでは切れてますが、右下に追加ボタンがあるのでクリック。

![Search Consoleのデータを取り込む](./images/2022/05/entry500-9.png)

これでSearch Consoleのデータを使えるようになったので、データソースの*データを統合*をクリック。

![Search Consoleのデータを取り込む](./images/2022/05/entry500-15.png)

*別のテーブルを結合*をクリック。

![Search Console データソースのデータを統合](./images/2022/05/entry500-10.png)

サイズにLanding Pageを選択。
![サイズにLanding Pageを選択](./images/2022/05/entry500-13.png)

結合の設定（Confiture join）をクリック。URLとLanding Pageの一致を条件とし、左外部結合を選びます。
![Confiture joinをクリック。URLとLanding Pageの一致を条件とし、左外部結合を選びます。](./images/2022/05/entry500-12.png)

Search Consoleでは以下を指標として選びました。

* Impressions（表示回数）
* URL Clicks(クリック数)
* URL CTR（クリック率）
* Avarage Position（掲載平均順位）

![指標はImpressions（表示回数）・URL Clicks(クリック数)・URL CTR（クリック率）・Avarage Position（掲載平均順位）](./images/2022/05/entry500-11.png)


各ページの指標にどれだけの数値があるのか一目瞭然です。

![空のレポートを作成しておく](./images/2022/05/entry500-14.png)

### Google アナリティクス と連携する（ユニバーサルアナリティクス）
Search Console同様、Google アナリティクス のデータを追加します。

![アナリティクスのデータを統合](./images/2022/05/entry500-17.png)

データが追加できたら、データソースを編集（鉛筆マーク）をクリック。

![データソースを編集（鉛筆マーク）をクリック](./images/2022/05/entry500-16.png)

#### スプシのURLとアナリティクスのランディングページの値が一致しないので専用のフィールドを作る
アナリティクスのディメンションには*ランディングページ*を使います。

アナリティクスのランディングページの値はドメインを除いたフルパスにってしまうので**他のデータと一致しません**。
```js
// アナリティクス
/blogs/entry500/
// 他のデータの値
https://ginneko-atelier.com/blogs/entry500/
```
そこでスプシやExcelでおなじみの*CONCAT関数*を使ってフィールドを作成し一致するURLを作成します。

![フィールド](./images/2022/05/entry500-19.png)

```js
CONTAT("https://ginneko-atelier.com/", ランディング ページ)
```
関数には上記のように設定しますが、少し入力すると候補が出てくるので、補助機能を活用しながら関数を登録していくとラクチンです。
<br>フィールドには名前が必要なので今回は*Perfect URL*としました。

![CONCAT関数でURLを作る](./images/2022/05/entry500-18.png)

適用をクリックします。

私の環境下（Mac Chrome）では適用をクリックしたあともモーダルが閉じません。モーダル外のどこかしらをクリックしたら閉じるので閉じない方はやってみてください。

#### Google アナリティクス と結合の設定と指標の設定
結合の設定（Confiture join）で左外部結合、表1（スプシ）は*URL*、表3（アナリティクス）は*Perfect URL*のフィールドを選択します。

![表1（スプシ）と表2（アナリティクス）を選択します](./images/2022/05/entry500-20.png)

アナリティクスの指標を追加します。
![アナリティクスの指標](./images/2022/05/entry500-21.png)

アナリティクスでは以下を指標として選びました。

* ページビュー数
* ユーザー数
* 直帰率
* 平均ページ滞在時間

### 統合したデータに出力したいディメンション、指標を設定し表にする

以下の取得するデータをセットしただけなので、実際に出力する表に必要なデータを設定していきます。

![データの統合の全体](./images/2022/05/entry500-22.png)

データの統合を保存して閉じ、実際の右側のパネルから指標とディメンションを設定します。

![統合したデータに出力したいディメンション、指標を設定し表にする](./images/2022/05/entry500-23.png)

指標を追加するとおそらく右側のアイコンがデフォルトでSUM（合計値）と表示されているので必要に応じてAVR（平均値）に切り替えます。

|ディメンション|
|-|
|URL（表1）|
|TITLE（表1）|
|指標|周囲系方式|
|-|-|
|Impressions（表示回数）|SUM|
|URL Clicks(クリック数)|SUM|
|URL CTR（クリック率）|AVR|
|Avarage Position（掲載平均順位）|AVR|
|ページビュー数|SUM|
|ユーザー数|SUM|
|直帰率|AVR|
|平均ページ滞在時間|AVR|

<small>※ SUMは合計、AVRは平均です。</small>

データの統合の全体はこんな感じになりました。

![データの統合の全体](./images/2022/05/entry500-23-1.png)

## 取得日時をコントロールする
日時を設定します。すべてのデータが一度に設定できたほうが便利なので、コントロールを使った方法をご紹介します。

上部メニューから*コントロールの追加*をクリックし*期間設定*を選択します。

![コントロールの追加](./images/2022/05/entry500-24.png)

表の位置を調整して、表の上にコントロールを設置します。期間を選んでおきます。

![表の上にコントロールを設置](./images/2022/05/entry500-25.png)

表のデフォルトの日付範囲を自動にしておきます。

![表のデフォルトの日付範囲を自動](./images/2022/05/entry500-26.png)

これでコントロールから日時を集計できるようになりました！

### リライト記事をフィールドを使って分類する（2022-06-22追記）

リライトする記事を条件ごと分類できるようにします。[【ブログのSEO対策】リライト記事の選び方](/blogs/entry444/)でリライト記事の選び方を紹介しました。せっかくなので、この記事の条件に沿って分類しできるようにします。

|アクション|指標|
|-|-|
|リライト|インプレッション数月間100以下|
|リライト|順位平均20位以下|
|リライト|順位平均11 ~ 20位でクリック率平均3%以下|
|リライト|直帰率/滞在時間90%以上/0秒|
|noindexもしくは削除|impression10以下/ページビュー10以下|
|-|ページビュー300以上|

<card id="/blogs/entry444/"></card>

ディメンションにフィールドを追加します。

![ディメンションにフィールドを追加](./images/2022/05/entry500-29.png)

フィールドにリライトという計算式を追加します。

![フィールドに計算式を追加](./images/2022/05/entry500-30.png)

データポータルでの条件式の書き方です。CASE文を使って分岐します。

```sql
CASE
WHEN 条件 THEN 値
ELSE デフォ値
END
```
まとめて書くとこんな感じになります。

```sql
CASE
WHEN Impressions IS NULL AND ページビュー数 IS NULL THEN "noindex"
WHEN Impressions < 10 AND ページビュー数 < 10 THEN "noindex"
WHEN Impressions < 10 AND ページビュー数 IS NULL THEN "noindex"
WHEN Impressions IS NULL AND ページビュー数 < 10 THEN "noindex"
WHEN ページビュー数 > 300 THEN "-"
WHEN Impressions < 300 AND Impressions > 50 THEN "Phase 1"
WHEN Impressions > 300 AND Average Position > 20  AND Average Position > 50 THEN "Phase 2"
WHEN Average Position > 10  AND Average Position < 20 AND URL CTR < 0.03 THEN "Phase 3"
WHEN 直帰率 > 0.9 OR 平均ページ滞在時間 < 10 THEN "Phase 4"
ELSE "-"
END
```

リライトすべき記事が抽出できるようになります。

![データスタジオ](./images/2021/03/entry444-3.png)

## 作成したデータをスプシに落とし、月ごとにまとめていきます。
どのようにリライトしたかなどログを残しておきたいですよね？ログを記録するように作成したデータをさらにスプシに変換します。

表の右上にケバブメニュー（縦3つのドット）があるのでそちらをクリックしエクスポートを選びます。

![表の右上にケバブメニュー（縦3つのドット）があるのでそちらをクリックしエクスポート](./images/2022/05/entry500-27.png)

スプレッドシートにチェックを入れエクスポートをクリックします。もちろん、ExcelやCSVでエクスポートもできます。

![スプレッドシートにチェックを入れエクスポート](./images/2022/05/entry500-28.png)

これで、いつどんなリライトをしたかログを残しておきつつ、効果測定が行なえます。

## まとめ・データポータルを使って各種データを統合すると全貌が把握できる
データポータルでデータを統合すると、総合的に見てどの記事を分析すればいいかなど把握しやすくなります。

今回この表を作るのも結構手探りで作りましたが、まだまだ紹介できていない機能があるのでまた記事にまとめられたらなーと思っています。

この記事が皆さんのWeb解析ライフの一助となれば幸いです。

最後までお読みいただきありがとうございました。
