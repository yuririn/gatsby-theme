---
title: concreteCMS・さくらレンタルサーバーでWAFを設定したら一部機能がつかえなくなった話
date: 2022-03-31
pagetype: blog
cateId: cms
hero: thumbnail/2022/entry494.png
tags: ["concrete5"]
description: 久々のコンクリネタです。先日、管理画面の特定の機能が動かなくなったconcrete5に遭遇しました。おそらく私のように苦悶して、原因を探っている人への救いになればと思いこの記事を書くことにしました。
lead: ["久々のコンクリネタです。先日、管理画面の特定の機能が動かなくなったconcrete5に遭遇しました。おそらく私のように苦悶して、原因を探っている人への救いになればと思いこの記事を書くことにしました。"]
---
## はじめに。concrete5 は concreteCMS になったよ
![concreteCMS](./images/2022/03/entry494-01.png)

https://www.concretecms.com/

ご存知かもしれませんが、concrete5 は名称が変わり concreteCMS になりました。

今はほとんどのCMSで見かけるようになったブロック型CMSの先駆けです。

<msg txt="フォーラムのみなさんも優しくて、質問したらすぐ答えがかえってきたり私をエンジニアとしてそだててくれたのもこのCMSのおかげです。"></msg>

最近9になったらしいのでまたそのへんのことは記事にまとめようと思います。

## 管理画面に入ると特定のファイルが４０３エラー
管理画面に入ると、更新やブロック追加ができなくなっていました。

Chromeの開発者ツールで確認するとコアにある一部のJSが403エラー（net::ERR_ABORTED 403・アクセス拒否）に。

```
Get [ドメイン]/ccm/assets/localization/core/js net::ERR_ABORTED 403
```

/concrete/以下にあるファイルにはちゃんとアクセスできている。

これが原因で管理画面のJSの一部が使えなくなっていた。

プリティURLの設定を外すともとに戻るという不可思議な現象が起こっていました。

### ズバリ、原因はWAFだった
403なのでリライト系の設定がおかしくなっているのかと思いきや、WAF（サーバー側のファイヤーウォール）が原因でした。

だいたいこの手の問題が起こるときは.htaccessあたりかと思ったんですが、ローカルに作った環境と何もかわらず、、、。

同じサーバー内に新たに立てたテスト環境、ローカル環境は全然問題なく動いてるし。。。

さくらのレンタルサーバーは私も昔使っていて、諸々設定でクセがあった記憶がありサーバーパネル内の違いを比較し、やっと見つけました。

最近はWordPress案件が多く、さくらサーバーとも遠のいていたので原因を突き止めるのに1日かかりました。。。。

設定を切ったら問題なく動くように。

## まとめ。部分的に403エラーが出たらWAFも疑え
こういうWAFのエラーは他のレンタルサーバーでも結構あるみたいです。

他にも、.htaccessなどの記述ミスで起こることもあるので複合的に検証しないといけませんが、もし同じような現象があった場合は可能性の一つとして疑うといいかもしれません。

良い勉強になりました。

今回はコンクリ用のDocker環境を作ったりもしたので、収穫も多かったです。

また、それに関しても記事にしようと思います！

<msg txt="concreteCMS の情報は少ないのでもっと発信していかなければ！"></msg>

この記事が、みなさんのコンクリライフの一助になると幸いです。

最後までお読みいただきありがとうございました。
