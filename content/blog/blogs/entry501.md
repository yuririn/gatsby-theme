---
title: 【GA4】タグマネで設置したイベントが計測できないときの確認方法
date: 2022-05-25
pagetype: blog
cateId: seo
hero: thumbnail/2022/entry501.png
tags: ["SEOライティング","Web解析"]
description: 設置したGTMタグがまったく発火してなくて焦ったこと有りませんか？Googleタグマネージャーにはちゃんと確認する機能プレビュー/タグアシスタント（Tag Assistant）がついているので、この2つの機能をしっかり使うことができれば問題有りません！ここでデバッグ（タグたちゃんと発火してるか）方法をわかりやすく解説します。
lead: ["設置したGTMタグがまったく発火してなくて焦ったこと有りませんか？","Googleタグマネージャーにはちゃんと確認する機能プレビュー/タグアシスタント（Tag Assistant）がついているので、この2つの機能をしっかり使うことができれば問題有りません！","そこでデバッグ（タグたちゃんと発火してるか）方法をわかりやすく解説します。"]
---
## GTMで設置したタグがなんで発火しないの？そんな方向けに書きました！
* プレビュー/タグアシスタント（Tag Assistant）の使い方を知りたい
* イベントが設置したいけどどうしていいかわからない
* マニュアル通りに設置したのにクリックイベントがうまく動かない
* 正しく設置しているはずなのにクリックイベントが発火するときとしない時がある

前提条件は、GTMのことを設置していてGAぐらいは設置できていて、少なからずなんとなく分かっていることです。

そもそもタグマネの設置の仕方がわからない方はこちらを御覧ください。

<card id="/blogs/entry474/"></card>

## Googleタグマネージャーのプレビューの使い方
設置したイベントが発火したかは、プレビューで確認できます。

この機能はコンテナーを公開する前でもタグがきちんと動くか（発火）確認できます。

対象のコンテナーのワークスペースの右上にある「プレビュー」をクリックします。

![プレビューをクリックし反映しているか確認](./images/2021/06/entry474-10.jpg)

タグアシスタント（Tag Assistant）というツールが別タブで開くので、確認したいサイトのURLを入力し、「Connect」ボタンをクリック。

![プレビューをクリックし反映しているか確認](./images/2021/06/entry474-22.jpg)

## コンテナーが読み込まれたタイミングで、GAやアドセンスのタグが読み込まれる
タグアシスタントを見ると、この銀ねこアトリエでは以下のようにイベントが順次読み込まれています。

1. Content Initialization
1. Initialization
1. *Container Loaded（GAやアドセンスなどのタグを読み込み）*
1. Gatsby-route-change
1. DOM Ready
1. Window Loaded

![](./images/2022/05/entry501-1.png)

各右側の項目をクリックすると度のタイミングでどのタグが発火したか切り替わり、確認することができます。

## 実際にタグを設置し、プレビューとタグアシスタントを使って確認してみよう
銀ねこアトリエでは読了（記事を読み終わったか）を確認するためのイベントを設定しています。

要素の表示（Element Visibility）というイベントを設定できるのですが、CTAエリアが50％表示されたら、読了タグが発火するようになっています。

![](./images/2022/05/entry501-3.png)

### 要素の表示イベントを利用して読了を計測するタグ作成
要素の表示イベントを利用して読了を計測するタグ作成し、プレビューとタグアシスタントで確認する方法をご紹介します。

タグの作り方は[【GA4】 Analytics と Google タグマネージャーを連携（画像解説28枚アリ）](/blogs/entry474/)でも紹介しているので、かなり端折ってご紹介します。

#### トリガー作成
新規トリガー作成でユーザーエンゲージメントから要素の表示を選択します。

![](./images/2022/05/entry501-6.png)

|選択|要素ID|タイミング|割合|発生場所|
|-|-|-|-|-|
|ID|end_fo_article|1ページに付き1度|50％|すべての表示イベント|

#### タグを作りトリガーをセットしておく（GA4のみ）
読了というGA4のタグを作成します。トリガーは先程作成したものをセットします。

![](./images/2022/05/entry501-7.png)

イベント名を読了とし、パラメーターをセットしておきます。

|パラメータ名|値|
|-|-|
|end_of_reading|{{Page URL}}|

後日、GA側でカスタムディメンションとして使います。

### 読了タグをプレビューとタグアシスタントを使ってデバッグ
読了タグをデバッグしてみましょう！

![](./images/2022/05/entry501-3.png)

コンバージョンエリアが表示されると7項目に*Element Visibility*が追加され、発火済みのタグ（Tags Fired）に読了タグが移動します。タグが発火したことが確認できました。「読了」をクリックして詳細を見ます。

![](./images/2022/05/entry501-2.png)

発火中のトリガー（Firing Triggers）にチェックがついていれば問題問題なく動いています。<br>
<small>Display Valueは非エンジニアの方はNameにしておきましょう。</small>

![](./images/2022/05/entry501-5.png)

## タグが発火しない原因の探り方
イベントのタグが発火しない原因はフィルター（filter）の設定が間違えている可能性大です。

* IDとクラス名を間違えてないか？
* 値の設定が含む、完全一致などを間違えていないか？
* ページのパスやリンクの値を間違えていないか？

探り方を2つご紹介します。

### フィルター（filter）の設定が間違えている。
必要があればプレビューもリロードイベントが発火する状態にして、タグを発火させます。

![](./images/2022/05/entry501-8.png)

条件を満たしているはずなのにTag Not Firedに分類されていたら、タグをクリックしてみます。

この場合Page Pathの値が間違えているのでタグが発火していない事がわかります。

![](./images/2022/05/entry501-9.png)

原因が分かったら、修正してもう一度プレビューしタグアシスタントでタグのトリガーが発火しているか確認してみます。

うまく行かない場合は、タグマネージャーのコンテナからプレビューをくりっくするところからやり直しましょう。

### 正しく設置しているはずなのにクリックイベントがうまく発火しない
クリックイベントがうまく発火しないのはGTMタグの設置方法だけが問題では有りません。

要素に派手なSVGのanimationなどを実装し、大半がボタンではなくSVGと認識してしまい、指定した要素をクリックしづらくなることがあります。

<msg txt="それが原因でタグが発火しないなんてことも、実際にありました！"></msg>

#### まずはどの要素をクリックされているか調べる
どの要素をクリックされたかを調べるためには、タグが発火する状況を作ります。

対象の箇所をクリックしたあと、タグアシスタントでAPI Callを開きgtm.elementが対象の要素とクリックした要素が一致しているか調べます。

![対象の箇所をクリックしたあと、タグアシスタントでAPI Callを開きgtm.elementが対象の要素とクリックした要素が一致しているか調べます](./images/2022/05/entry501-10.png)

一致したりしなかったりする場合は以下の対処を考えます。

#### クリックしたものが対象の要素と違うときの対処法
根本的にHTMLやCSSを思い切り変えれば解決する場合も多いと思いですがそうも行かない場合がありますよね?

<msg txt="HTMLの書き方を変えるか、GTMタグを2つ作るしか有りません。"></msg>

```html
<button id="request">
  <svg id="likeAnimation"><!--/こちらが反応している-->
</button>
```

今回はGTM専用のカスタムデータ`data-gtm-click`を追加します。

```html:title=HTMLを変更する場合
<button id="request" data-gtm-click="request">
  <svg id="likeAnimation" data-gtm-click="request">
</button>
```
GTM側でカスタムデータ用の変数を作成します。

![GTM側でカスタムデータ用の変数を作成します](./images/2022/05/entry501-11.png)

|変数のタイプ|変数タイプ|属性名|
|-|-|-|
|自動イベント変数|要素の属性|data-gtm-click|

トリガーの方へ一部のクリック、カスタムデータ=requestにしておけばOK。

![](./images/2022/05/entry501-12.png)

これでどちらがクリックされても問題なくクリックイベントが発火するようになります。

タグをさわれない場合はGTMでタグを2つ作ります。

ID `request` とID `likeAnimation` でクリックされた場合の2通りです。

#### ダブルカウントが気になる場合は除外トリガーを設定
除外トリガー（または「ブロック トリガー」）は、特定の条件下で別のトリガー機能が発動するのをブロックするために使用できるトリガーの一種です。

ダブルカウントが怖い場合は除外トリガーを作成して登録したほうがいいかもしれません。

![](./images/2022/05/entry501-13.png)

## プレビュー/タグアシスタント（Tag Assistant）を丁寧に使えばタグは正しく設置できる

今回は「正しく設置しているはずなのにクリックイベントがうまく発火しない」ことがきっかけでGTMのプレビューとタグアシスタント（Tag Assistant）を突き詰めてみました。

実はGTMは昨年から触り始め今年ようやく一年目です。今まではイベントタグ直埋めでしたが、使えるようになるとなんと便利かと日々目を丸くしています。

私はブログ7年目という遅咲きで設置して一昨年末くらいからゆるりとこのブログのSEO対策してます。

<msg txt="もっと勉強しておけばさっさと設置したのに後の祭り！"></msg>

イベントがGAのデータとして登録されるまで時間はかかりますが、蓄積されたデータは宝になるので初期でできるだけ正しく設定しておくことをオススメします。

この記事が皆さんのSEOライフの一助となれば幸いです。

最後までお読みいただきありがとうございました。
