{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogs/entry284/","result":{"data":{"site":{"siteMetadata":{"title":"銀ねこアトリエ"}},"allFile":{"edges":[{"node":{"name":"entry208","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/8254b94589f4e01c45ecb5ad8f4ae9c4/0fbb2/entry208.png","srcSet":"/static/8254b94589f4e01c45ecb5ad8f4ae9c4/294f4/entry208.png 375w,\n/static/8254b94589f4e01c45ecb5ad8f4ae9c4/0fbb2/entry208.png 640w","sizes":"(min-width: 640px) 640px, 100vw"},"sources":[{"srcSet":"/static/8254b94589f4e01c45ecb5ad8f4ae9c4/fd9fd/entry208.webp 375w,\n/static/8254b94589f4e01c45ecb5ad8f4ae9c4/66a24/entry208.webp 640w","type":"image/webp","sizes":"(min-width: 640px) 640px, 100vw"}]},"width":640,"height":480}}}}]},"markdownRemark":{"id":"87948354-070f-5c7e-b0a3-70bb57f55c7c","excerpt":"MySQLのアップグレード バックのことはさほど分かっていないくせに、Vagrant を構築してしょっ中作っては壊しています。 もっぱら Vagrant…","html":"<h2 id=\"mysqlのアップグレード\">MySQLのアップグレード</h2>\n<p>バックのことはさほど分かっていないくせに、Vagrant を構築してしょっ中作っては壊しています。</p>\n<p>もっぱら Vagrant の構築はいただきもののシェルスクリプトを使いまわしてます。めちゃめちゃ重宝していて、たまに改変してます。</p>\n<p>ちょっと前に作成したサイトを最近リニューアルする必要があり、本番環境のMySQL の 5.7系だったので、仮想環境も念のため 5.7にしなければならず。。。</p>\n<p>しかしいただいたシェルスクリプトは 5.1 系で書いてあるし、インストールの仕方が違うらしくシェルスクリプトを改造する自信はなく。。。。</p>\n<p>一応改造は試みましたがうまく行かず撃沈。いったん構築してしまってアップグレードすることにしました。</p>\n<h2 id=\"mysql-51-から-57-に-アップグレードするには2段階のステップを踏まなければならない\">MySQL 5.1 から 5.7 に アップグレードするには2段階のステップを踏まなければならない</h2>\n<p>ワタクシの環境はちなみに CentOS 6.4 です。</p>\n<p>MySQL 5.1 が古いのか、バージョンアップするためにはまず、5.6系にあげなければならないそう。</p>\n<p>こちらのブログを参考にさせていただきました。</p>\n<p><a href=\"https://qiita.com/tachitechi/items/b59278a16f636651410f\">MySQL5.1から5.7にバージョンアップさせるための手順</a></p>\n<h2 id=\"まずは-56-系へアップグレード\">まずは 5.6 系へアップグレード</h2>\n<p>vagrant sshで入り、まずはバージョン確認。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># vagrant ssh</span></code></pre></div>\n<p>特権レベルにセット。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># sudo -i</span></code></pre></div>\n<p>まずはmysqlをシャットダウン。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># service mysqld stop</span></code></pre></div>\n<p>既存のmysqlを削除</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum remove mysql*</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm</span></code></pre></div>\n<p>落ちてこない人は直接、ルートにmysql-community-release-el6-5.noarch.rpmを置いて yum install すればいいと思う。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /vagrant\n<span class=\"token comment\"># yum -y install mysql-community-release-el6-5.noarch.rpm</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum-config-manager --disable mysql55-community</span>\n<span class=\"token comment\"># yum-config-manager --enable mysql56-community</span></code></pre></div>\n<p>yum-config-managerでエラーになる人は以下コマンドを実行して、上のコマンドをもう一度叩いてみてください。</p>\n<p><a href=\"https://akamist.com/blog/archives/942\">[yum]yum-config-managerコマンドの実行でcommand not foundエラー</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum -y install yum-utils</span></code></pre></div>\n<p>インストール。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum install mysql mysql-devel mysql-server mysql-utilities</span></code></pre></div>\n<p>ここですでにDBがあるとおそらく mysqld が起動できないはずです。</p>\n<p>なので、まずはログを確認してみます。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># less /var/log/mysqld.log</span></code></pre></div>\n<p>Mac ではログファイルを開いたら shift + g で一番下まで行けます。</p>\n<p><code class=\"language-text\">b</code> で1ページ戻り、space で次のページ、<code class=\"language-text\">q</code> でログファイルを抜けることができます。</p>\n<p>先に DB を作ってしまってたせいか、不要なファイルができていたのでこいつを削除しにいきます。</p>\n<p>ちゃんとした理由についてはこちらをご覧ください。</p>\n<p><a href=\"https://www.ilovex.co.jp/blog/system/projectandsystemdevelopment/mycnfinnodbmysql.html\">my.cnfでinnodb関連の設定後、MySQLが起動しなくなった</a></p>\n<p>ディレクトリーを移動して中身を確認。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># cd /var/lib/mysql</span>\n<span class=\"token comment\"># ls(もしくはll)</span></code></pre></div>\n<p>下の三つが不要なので強制削除します。<br>\n※もちろんエラー内容を確認の上削除。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># rm -rf ib_logfile0</span>\n<span class=\"token comment\"># rm -rf ib_logfile1</span>\n<span class=\"token comment\"># rm -rf ibdata1</span></code></pre></div>\n<h3 id=\"fatal-error-cant-open-and-lock-privilege-tables-table-mysqluser-doesnt-existというエラーが出た場合\">Fatal error: Can’t open and lock privilege tables: Table ‘mysql.user’ doesn’t existというエラーが出た場合</h3>\n<p>インストール時に mysql_install_db が実行されるが、ディレクトリがわからない状態なので、インストール場所とユーザ名を指定して明示的に実行すると良いようです。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># mysql_install_db --datadir=/var/lib/mysql --user=mysql</span></code></pre></div>\n<p><a href=\"http://satoh-d.hatenablog.com/entry/2015/04/11/100204\">MySQLの起動時に “Fatal error: Can’t open and lock privilege tables: Table ‘mysql.host’ doesn’t exist”というエラーが出た</a>\nこれで無事再起動できるはずです。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># service mysqld start</span></code></pre></div>\n<p>アップグレードします。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># mysql_upgrade -u root</span></code></pre></div>\n<p>パスワードを設定している場合はお尻に -p をつけてパスワード入力します。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># mysql_upgrade -u root -p</span></code></pre></div>\n<p>バージョン確認。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># mysql --version</span></code></pre></div>\n<p>ようやく5.6系になりました。</p>\n<h2 id=\"57にアップグレード\">5.7にアップグレード</h2>\n<p>続けて、5.7 にアップグレードします。</p>\n<p>まずはmysqlをシャットダウン。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># service mysqld stop</span></code></pre></div>\n<p>せっかく作ったけど、のmysqlを削除。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum remove mysql*</span></code></pre></div>\n<p>5.7を有効化</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum-config-manager --disable mysql56-community</span>\n<span class=\"token comment\"># yum-config-manager --enable mysql57-community-dmr</span></code></pre></div>\n<p>インストール</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># yum install mysql mysql-devel mysql-server mysql-utilitie</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># service mysqld start</span>\n<span class=\"token comment\"># mysql_upgrade -u root</span>\n//もしくは\n<span class=\"token comment\"># mysql_upgrade -u root -p</span></code></pre></div>\n<p>無事アップグレードできているはずです。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># mysql --version</span></code></pre></div>\n<h3 id=\"まとめ\">まとめ</h3>\n<p>今回 MySQL のバージョンアップにチャレンジすることで、mysql のエラーログの見方を覚えたりバージョンの切り替えを覚えることができました。</p>\n<p>ハマってよかったーーー。</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#mysql%E3%81%AE%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89\">MySQLのアップグレード</a></p>\n</li>\n<li>\n<p><a href=\"#mysql-51-%E3%81%8B%E3%82%89-57-%E3%81%AB-%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF2%E6%AE%B5%E9%9A%8E%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E3%82%92%E8%B8%8F%E3%81%BE%E3%81%AA%E3%81%91%E3%82%8C%E3%81%B0%E3%81%AA%E3%82%89%E3%81%AA%E3%81%84\">MySQL 5.1 から 5.7 に アップグレードするには2段階のステップを踏まなければならない</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%BE%E3%81%9A%E3%81%AF-56-%E7%B3%BB%E3%81%B8%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89\">まずは 5.6 系へアップグレード</a></p>\n<ul>\n<li><a href=\"#fatal-error-cant-open-and-lock-privilege-tables-table-mysqluser-doesnt-exist%E3%81%A8%E3%81%84%E3%81%86%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E5%87%BA%E3%81%9F%E5%A0%B4%E5%90%88\">Fatal error: Can’t open and lock privilege tables: Table ‘mysql.user’ doesn’t existというエラーが出た場合</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#57%E3%81%AB%E3%82%A2%E3%83%83%E3%83%97%E3%82%B0%E3%83%AC%E3%83%BC%E3%83%89\">5.7にアップグレード</a></p>\n<ul>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81\">まとめ</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"MySQL を 5.1 から 5.7 系にアップグレードする際にハマりました","date":"2018.09.23","description":"grant の MySQL を 5.1 から 5.7 系にアップグレードする際にどハマりし、結局助けてもらってなんとかアップグレードしたのでそのやり方をメモします。","lead":["grant の MySQL を 5.1 から 5.7 系にアップグレードする際にどハマりし、結局助けてもらってなんとかアップグレードしたのでそのやり方をメモします。"],"hero":"2014/entry208.png","cateId":"web-developer","tags":["DB"],"pagetype":"blog","modifieddate":null}},"previous":{"fields":{"slug":"/blogs/entry276/"},"frontmatter":{"title":"やりたかったから広島でSEOの勉強会します！"}},"next":{"fields":{"slug":"/blogs/entry279/"},"frontmatter":{"title":"SEO 勉強会「『Googleに聞きたい！ 検索エンジンQ&A』」無事終わりました"}}},"pageContext":{"id":"87948354-070f-5c7e-b0a3-70bb57f55c7c","previousPostId":"bf43fc39-262a-5931-9c95-e85446aa2934","nextPostId":"de830df8-7c63-5823-a482-7459ff8c1768","hero":"2014/entry208.png"}},"staticQueryHashes":["1145805751","2829560153","3000541721","3766793980"]}