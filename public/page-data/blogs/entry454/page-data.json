{"componentChunkName":"component---src-templates-blog-post-js","path":"/blogs/entry454/","result":{"data":{"site":{"siteMetadata":{"title":"銀ねこアトリエ"}},"allFile":{"edges":[{"node":{"name":"entry454","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#586858","images":{"fallback":{"src":"/static/90cdc9201192950b5845d0c239e22c9f/88c96/entry454.jpg","srcSet":"/static/90cdc9201192950b5845d0c239e22c9f/e23da/entry454.jpg 350w,\n/static/90cdc9201192950b5845d0c239e22c9f/cd750/entry454.jpg 750w,\n/static/90cdc9201192950b5845d0c239e22c9f/5caa2/entry454.jpg 1080w,\n/static/90cdc9201192950b5845d0c239e22c9f/88c96/entry454.jpg 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/90cdc9201192950b5845d0c239e22c9f/4c075/entry454.webp 350w,\n/static/90cdc9201192950b5845d0c239e22c9f/e56aa/entry454.webp 750w,\n/static/90cdc9201192950b5845d0c239e22c9f/257a3/entry454.webp 1080w,\n/static/90cdc9201192950b5845d0c239e22c9f/296b8/entry454.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":900}}}}]},"markdownRemark":{"id":"3bc12bc3-3ad9-52b0-8e08-324e1cf1c1aa","excerpt":"この記事を参考にする上での注意点 この記事のコードはWordPressのコーディング規約に沿って書いてあります。 ヨーダ記法など初学者にはなんでこの書き方？ってコードもあるかもなので、以下記事を参考にしてください。 phpcsでWordPress…","html":"<h2 id=\"この記事を参考にする上での注意点\">この記事を参考にする上での注意点</h2>\n<p>この記事のコードはWordPressのコーディング規約に沿って書いてあります。</p>\n<p>ヨーダ記法など初学者にはなんでこの書き方？ってコードもあるかもなので、以下記事を参考にしてください。</p>\n<a class=\"article-link\" href=\"/blogs/entry417/\">\n<section><div class=\"article-link__img\"><img alt=\"WordPress phpcsでコーディング規約を守るコード\" src=\"/static/4e7d7db8849ad47fcf44a549cf857b2a/f836f/entry452.jpg\" width=\"150\" height=\"113\" class=\"\"></div><div class=\"article-link__main\">\n<div class=\"article-link__main__title\">WordPress phpcsでコーディング規約を守るコード</div>\n<p class=\"description\">この記事はWordPressのコーディング規約をphpcs導入して入れたものの、エラー英語だしよくわかんないって嘆いている人向け･･</p>\n<p>\n<time datetime=\"2021-04-05\">2021.04.05</time>\n</p>\n</div>\n</section></a>\n<p>phpcsでWordPressコーディング規約を設定しておくといいです。</p>\n<h2 id=\"カスタムフィールドからコンパクトにタイトルやメタディスクリプションを編集できるようにする\">カスタムフィールドからコンパクトにタイトルやメタディスクリプションを編集できるようにする</h2>\n<p>カスタムフィールドは追加、アップデート、取得、削除用（CRUD）の関数が用意されています。</p>\n<p><small>※ C…Create、R…Read、U…Update、D…Delete</small></p>\n<p>ぶっちゃけ、<code class=\"language-text\">add_post_meta</code>は<code class=\"language-text\">update_post_meta</code>で代用できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// 追加</span>\n<span class=\"token function\">add_post_meta</span><span class=\"token punctuation\">(</span>  ページの<span class=\"token constant\">ID</span><span class=\"token punctuation\">,</span> カスタムフィールド名 <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 取得</span>\n<span class=\"token function\">get_post_meta</span><span class=\"token punctuation\">(</span> ページの<span class=\"token constant\">ID</span><span class=\"token punctuation\">,</span> カスタムフィールド名 <span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// アップデート</span>\n<span class=\"token function\">update_post_meta</span><span class=\"token punctuation\">(</span> ページの<span class=\"token constant\">ID</span><span class=\"token punctuation\">,</span> カスタムフィールド名 <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 削除</span>\n<span class=\"token function\">delete_post_meta</span><span class=\"token punctuation\">(</span> ページの<span class=\"token constant\">ID</span><span class=\"token punctuation\">,</span> カスタムフィールド名 <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>この関数を使ってカスタムフィールドを編集します。</p>\n<p>にタイトルやメタディスクリプションを編集できるようにカスタムフィールドを表示するエリアを追加します。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">/**\n * Show custom field\n */\nfunction seo_fields() {\n\tglobal $post;\n\t$metatitle   = get_post_meta( $post->ID, 'metatitle', true );\n\t$description = get_post_meta( $post->ID, 'description', true );\n\t?>\n\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>resiter<span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>resister<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>タイトル<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>metatitle<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token function\">attr_html</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$metatitle</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span>  <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>large-text code<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>タイトル<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>metatitle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>titleNum<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>文字<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>検索された時に表示されるタイトルです。35文字から41文字以内に収めるのが理想です。<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>説明文<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>textarea</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>large-text code<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rows</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>3<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>このページの説明文<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>metadescription<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token function\">attr_html</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$description</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>textarea</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>descriptionNum<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>文字<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>検索された時に表示されるタイトルです。130文字以内に収めるのが理想です。<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\t<span class=\"token function\">wp_nonce_field</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'seo'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'seo_field'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<p><code class=\"language-text\">wp_nonce_field</code>を追記しました。</p>\n<ul>\n<li><a href=\"https://developer.wordpress.org/themes/theme-security/using-nonces/\">Using Nonces</a></li>\n<li><a href=\"https://wpdocs.osdn.jp/%E9%96%A2%E6%95%B0%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9/wp_verify_nonce\">wp verify nonce</a></li>\n</ul>\n<p>表示するためには<code class=\"language-text\">admin_menu</code>を<code class=\"language-text\">add_action</code>にフックさせます。</p>\n<p>これでpost（投稿）とpage（固定）にカスタムフィールドを追加できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Add custom field\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">add_seo_fields</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">add_meta_box</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'seo_sectionid'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'SE0情報の登録'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'seo_fields'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'post'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">add_meta_box</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'seo_sectionid'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'SE0情報の登録'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'seo_fields'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'page'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'admin_menu'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'add_seo_fields'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"カスタムフィールドのデータを保存する\">カスタムフィールドのデータを保存する</h2>\n<p>このままだと管理画面の一覧の方でタイトルなど編集したらデータが消えます。</p>\n<p>一覧だろうが、詳細だろうが保存の際に同じように処理されるけど、一覧では保存する値が存在しないので削除処理されてしまいます。</p>\n<p><del>ちょっと力技ですが、管理画面が一覧か、詳細なのかを判断するのに<code class=\"language-text\">action</code>パラメーターがあるかで削除処理するかの処理を入れました。</del></p>\n<p><br>上記、global変数<code class=\"language-text\">$pagenow</code>を追加し、ページテンプレート名を取得する方法に切り替えました。</p>\n<p>先ほどの<code class=\"language-text\">wp_verify_field</code>で生成したnonceを<code class=\"language-text\">wp_verify_nonce</code>で確認します。nonceが無効ならfalseを返します。これでエラーは発生しなくなるはずです。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Save data\n *\n * @param string $post_id is id.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">save_seo_fields</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">global</span> <span class=\"token variable\">$pagenow</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'seo_field'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span> <span class=\"token function\">wp_verify_nonce</span><span class=\"token punctuation\">(</span> <span class=\"token function\">sanitize_text_field</span><span class=\"token punctuation\">(</span> <span class=\"token function\">wp_unslash</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'seo_field'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'seo'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'metatitle'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$metatitle</span> <span class=\"token operator\">=</span> <span class=\"token function\">sanitize_text_field</span><span class=\"token punctuation\">(</span> <span class=\"token function\">wp_unslash</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'metatitle'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">update_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'metatitle'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$metatitle</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">is_admin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'post.php'</span> <span class=\"token operator\">===</span> <span class=\"token variable\">$pagenow</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">delete_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'metatitle'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'description'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$description</span> <span class=\"token operator\">=</span> <span class=\"token function\">sanitize_text_field</span><span class=\"token punctuation\">(</span> <span class=\"token function\">wp_unslash</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'description'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">update_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'description'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$description</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token function\">is_admin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'post.php'</span> <span class=\"token operator\">===</span> <span class=\"token variable\">$pagenow</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token function\">delete_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'description'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'save_post'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'save_seo_fields'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"管理画面の投稿一覧に表示する\">管理画面の投稿一覧に表示する</h2>\n<p>カラムを追加します。コメントのカラムはいらないので<code class=\"language-text\">unset()</code>で削除します。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Add column for voice list admin page\n *\n * @param string $columns is voice.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">add_seo_posts_columns</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$columns</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'post'</span> <span class=\"token operator\">===</span> <span class=\"token function\">get_post_type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string single-quoted-string\">'page'</span> <span class=\"token operator\">===</span> <span class=\"token function\">get_post_type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$columns</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'metatitle'</span><span class=\"token punctuation\">]</span>   <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'メタタイトル'</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$columns</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'description'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'ページの説明'</span><span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">unset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$columns</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'comments'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token variable\">$columns</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>各カラムにどんな出力をするかコードを書きます。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">/**\n * Add column for Post, Page list admin page\n *\n * @param string $column_name is posts.\n * @param string $post_id is id.\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">seo_posts_custom_column</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$column_name</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$post_id</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'post'</span> <span class=\"token operator\">===</span> <span class=\"token function\">get_post_type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string single-quoted-string\">'page'</span> <span class=\"token operator\">===</span> <span class=\"token function\">get_post_type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'metatitle'</span> <span class=\"token operator\">===</span> <span class=\"token variable\">$column_name</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$title_data</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'metatitle'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$title_data</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token function\">esc_html</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$title_data</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">echo</span>  <span class=\"token string single-quoted-string\">'None'</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'description'</span> <span class=\"token operator\">===</span> <span class=\"token variable\">$column_name</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">!==</span> <span class=\"token function\">get_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'description'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token variable\">$description</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'description'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">echo</span>  <span class=\"token string single-quoted-string\">'None'</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\n\t\t\t<span class=\"token keyword\">echo</span> <span class=\"token function\">esc_html</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$description</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'manage_posts_columns'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'add_seo_posts_columns'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'manage_posts_custom_column'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'seo_posts_custom_column'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>これで管理画面の各投稿一覧にも表示されるように、どの投稿にタイトルタグやディスクリプションが設定されていないか一目瞭然です。</p>\n<h2 id=\"おまけ・jsで文字のカウント機能をつける\">おまけ・JSで文字のカウント機能をつける</h2>\n<p>もっとSEOを充実させるために<a href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%81%8B%E3%82%89%E3%82%B3%E3%83%B3%E3%83%91%E3%82%AF%E3%83%88%E3%81%AB%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%82%84%E3%83%A1%E3%82%BF%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\">カスタムフィールドからコンパクトにタイトルやメタディスクリプションを編集できるようにする</a>の<code class=\"language-text\">seo_fields()</code>に、カウント機能を追加します。</p>\n<p>ちなみに以下コードはバニラJSです。面倒だった。。。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">/**\n * Show custom field\n */\nfunction seo_fields() {\n//省略\n?>\n <span class=\"token comment\">&lt;!-- 省略 --></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token keyword\">const</span> titleNum <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'titleNum'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> metatitle <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'metatitle'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> metadescription <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'metadescription'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> descriptionNum <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'descriptionNum'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\ttitleNum<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> metatitle<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>metatitle<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">41</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\ttitleNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\ttitleNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\tmetatitle<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keyup\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\ttitleNum<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> metatitle<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>metatitle<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">41</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t\ttitleNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\ttitleNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t\tdescriptionNum<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> metadescription<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>metadescription<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">130</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\tdescriptionNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\tdescriptionNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\n\t\tmetadescription<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"keyup\"</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">event</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\tdescriptionNum<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> metadescription<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>metadescription<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">130</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t\tdescriptionNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tdescriptionNum<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\t<span class=\"token comment\">//省略</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<h2 id=\"まとめ・カスタマイズするならコンパクトだけどユーザーファースト\">まとめ・カスタマイズするならコンパクトだけどユーザーファースト</h2>\n<p>色々応用できるので、よかったら参考にしてください。</p>\n<p>この記事がWordPressカスタマイズライフの一助となりますように。</p>\n<p>最後までお読みいただきありがとうございました。</p>","tableOfContents":"<ul>\n<li><a href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%82%92%E5%8F%82%E8%80%83%E3%81%AB%E3%81%99%E3%82%8B%E4%B8%8A%E3%81%A7%E3%81%AE%E6%B3%A8%E6%84%8F%E7%82%B9\">この記事を参考にする上での注意点</a></li>\n<li><a href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%81%8B%E3%82%89%E3%82%B3%E3%83%B3%E3%83%91%E3%82%AF%E3%83%88%E3%81%AB%E3%82%BF%E3%82%A4%E3%83%88%E3%83%AB%E3%82%84%E3%83%A1%E3%82%BF%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\">カスタムフィールドからコンパクトにタイトルやメタディスクリプションを編集できるようにする</a></li>\n<li><a href=\"#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%95%E3%82%A3%E3%83%BC%E3%83%AB%E3%83%89%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%BF%9D%E5%AD%98%E3%81%99%E3%82%8B\">カスタムフィールドのデータを保存する</a></li>\n<li><a href=\"#%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E3%81%AE%E6%8A%95%E7%A8%BF%E4%B8%80%E8%A6%A7%E3%81%AB%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B\">管理画面の投稿一覧に表示する</a></li>\n<li><a href=\"#%E3%81%8A%E3%81%BE%E3%81%91%E3%83%BBjs%E3%81%A7%E6%96%87%E5%AD%97%E3%81%AE%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B\">おまけ・JSで文字のカウント機能をつける</a></li>\n<li><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81%E3%83%BB%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%81%99%E3%82%8B%E3%81%AA%E3%82%89%E3%82%B3%E3%83%B3%E3%83%91%E3%82%AF%E3%83%88%E3%81%A0%E3%81%91%E3%81%A9%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%95%E3%82%A1%E3%83%BC%E3%82%B9%E3%83%88\">まとめ・カスタマイズするならコンパクトだけどユーザーファースト</a></li>\n</ul>","frontmatter":{"title":"プラグインなしでWordPressのカスタムフィールドを追加&管理画面投稿一覧に出力","date":"2021.04.11","description":"WordPressでもSEO Packなどを使わずカスタムフィールドの実装だけでタイトルやメタディスクリプションを編集できるようにできます。カスタムフィールドの値が管理画面の各投稿一覧から確認できたら便利と思い実装したのでまとめました！一覧を編集したらカスタムフィールドが消えるバグの対処方法もついでにまとめてます。","lead":["WordPressでもSEO Packなどを使わずカスタムフィールドの実装だけでタイトルやメタディスクリプションを編集できるようにできます。カスタムフィールドの値が管理画面の各投稿一覧から確認できたら便利と思い実装したのでまとめました！","一覧を編集したらカスタムフィールドが消えるバグの対処方法もついでにまとめてます。"],"hero":"2021/entry454.jpg","cateId":"cms","tags":["WordPress"],"pagetype":"blog","modifieddate":null}},"previous":{"fields":{"slug":"/blogs/entry453/"},"frontmatter":{"title":"憧れの海外ノマドワーカー。未経験でもエンジニアでもなれるの？"}},"next":{"fields":{"slug":"/blogs/entry455/"},"frontmatter":{"title":"スプシのデータをJSON化してウェブサイトに取り込む（Sheets API使いません）"}}},"pageContext":{"id":"3bc12bc3-3ad9-52b0-8e08-324e1cf1c1aa","previousPostId":"5931deae-fa1f-5ddc-9945-755df006689d","nextPostId":"f7836ac6-98fd-560c-9561-4c746d0d3f7d","hero":"2021/entry454.jpg"}},"staticQueryHashes":["1145805751","2829560153","3000541721","3766793980"]}