{"data":{"site":{"siteMetadata":{"title":"銀ねこアトリエ"}},"allFile":{"edges":[{"node":{"name":"entry401","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8e8d8","images":{"fallback":{"src":"/static/206512c4ac54a09bce7ea7c2b867aeaa/018b3/entry401.jpg","srcSet":"/static/206512c4ac54a09bce7ea7c2b867aeaa/15952/entry401.jpg 375w,\n/static/206512c4ac54a09bce7ea7c2b867aeaa/018b3/entry401.jpg 640w","sizes":"(min-width: 640px) 640px, 100vw"},"sources":[{"srcSet":"/static/206512c4ac54a09bce7ea7c2b867aeaa/fd9fd/entry401.webp 375w,\n/static/206512c4ac54a09bce7ea7c2b867aeaa/66a24/entry401.webp 640w","type":"image/webp","sizes":"(min-width: 640px) 640px, 100vw"}]},"width":640,"height":480}}}}]},"markdownRemark":{"id":"79d0d7e3-86b0-5a37-8cbd-8d52a0319860","excerpt":"今までのGatsbyの記事と注意点 現在ここまで記載しています。制作するまでを目標にUPしていくので順を追ったらGatsbyサイトが作れると思います。 インストールからNetlify…","html":"<h2 id=\"今までのgatsbyの記事と注意点\">今までのGatsbyの記事と注意点</h2>\n<p>現在ここまで記載しています。<br>制作するまでを目標にUPしていくので順を追ったらGatsbyサイトが作れると思います。</p>\n<ol>\n<li><a href=\"/blogs/entry401/\">インストールからNetlifyデプロイまで</a></li>\n<li><a href=\"/blogs/entry406/\">投稿ページの充実と画像の方法</a></li>\n<li><a href=\"/blogs/entry408/\">ブログ記事、カテゴリー、タグ一覧の出力</a></li>\n<li><a href=\"/blogs/entry410/\">プラグインを利用して目次出力</a></li>\n<li><a href=\"/blogs/entry413/\">プラグインナシで一覧にページネーション実装</a></li>\n<li><a href=\"/blogs/entry416/\">個別ページテンプレート作成</a></li>\n<li><a href=\"/blogs/entry418/\">プラグインHelmetでSEO調整</a></li>\n<li><a href=\"/blogs/entry421/\">CSSコンポーネントでオリジナルページを作ろう！！</a></li>\n<li>関連記事一覧出力（←イマココ）</li>\n</ol>\n<h3 id=\"このシリーズではテーマgatsby-starter-blogを改造\">このシリーズではテーマGatsby Starter Blogを改造</h3>\n<p>この記事は一番メジャーなテンプレート、「<em>Gatsby Starter Blog</em>」を改造しています。同じテーマでないと動かない可能性があります。</p>\n<h2 id=\"staticqueryタグを使って同じタグとカテゴリーの記事を絞り込む\">StaticQueryタグを使って同じタグとカテゴリーの記事を絞り込む</h2>\n<p>類似記事を絞り込む条件です。</p>\n<ul>\n<li>タイトルがかぶっていない</li>\n<li>カテゴリーが一緒</li>\n<li>タグが一緒</li>\n</ul>\n<p>上記の条件の記事をPickupしランダムで6記事程度出力します。</p>\n<p>今回触るファイルです。relatedList.jsを追加します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/プロジェクト\n  ├ components/\n  |  └ blogs/\n  |    └ relatedList.js(追加)\n  └ templates/\n     └ blog-post.pug(追記)</code></pre></div>\n<h3 id=\"絞り込み機能を作る\">絞り込み機能を作る</h3>\n<p>下記の条件でGraphQLをセットします。</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">query {\n  allMarkdownRemark {\n    edges {\n      node {\n        <span class=\"token keyword\">fields</span> {\n          slug\n        }\n        id\n        frontmatter {\n          <span class=\"token keyword\">date</span><span class=\"token punctuation\">(</span>formatString: <span class=\"token string\">\"YYYY.MM.DD\"</span><span class=\"token punctuation\">)</span>\n          hero\n          title\n          cateId\n          tags\n          pagetype\n        }\n      }\n    }\n  }\n}</code></pre></div>\n<p>取得したデータを絞り込みます。</p>\n<p>当サイトではタグとカテゴリーの設定があり、カテゴリーは1種類、タグは複数選択可能というルールになっています。</p>\n<p>関連記事では同じ記事を除いた、類似記事を絞り込みます。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">render<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> posts <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// タイトルは除外</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title <span class=\"token operator\">!==</span> title<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// カテゴリーの一致出力</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>cateId <span class=\"token operator\">===</span> category<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n              post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>cateId <span class=\"token operator\">===</span> category\n            <span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n          <span class=\"token comment\">// タグの一致出力</span>\n          <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> tag <span class=\"token keyword\">of</span> tags<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> item <span class=\"token keyword\">in</span> post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tag <span class=\"token operator\">===</span> post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">)</span><span class=\"token comment\">/* end filter*/</span>\n\n\t<span class=\"token comment\">// 省略</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"関連記事が存在したらランダム出力する\">関連記事が存在したらランダム出力する</h3>\n<p>関連記事の条件に一致するものがなければ処理を中断し、あれば一覧をシャッフルし6記事に絞り込みます。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 一致するものがなければ処理しない</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>posts<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n<span class=\"token comment\">// 関連記事が取得できたらシャッフル</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">shuffle</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">list</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> j <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">===</span> j<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> k <span class=\"token operator\">=</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> list<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    list<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> k<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 関数実行</span>\n<span class=\"token function\">shuffle</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 6記事に絞りこむ</span>\nposts <span class=\"token operator\">=</span> posts<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><br>抽出結果を出力返します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>section <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-section l-container is-view\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>h2 <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"c-heading--lg\"</span><span class=\"token operator\">></span>関連記事もあわせてお読みください<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"c-grid\"</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>posts<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>List item<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">}</span> url<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"結果を出力するコンポーネント作成\">結果を出力するコンポーネント作成</h3>\n<p>コンポーネントを通じて出力します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">List</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> item<span class=\"token punctuation\">,</span> url <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">,</span> hero <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> item\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>article <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard c-grid__item--md6 c-grid__item--lg4\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Link <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__img\"</span> to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>hero <span class=\"token operator\">?</span> <span class=\"token operator\">&lt;</span>Image filename<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>hero<span class=\"token punctuation\">}</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">> : &lt;Image filename=\"common</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">dummy</span></span><span class=\"token punctuation\">.</span>png\" <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__date\"</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span>date<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__body\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>h3 <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__heading\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h3<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"関連記事を出力するコンポーネントのコードをまとめて書くと\">関連記事を出力するコンポーネントのコードをまとめて書くと</h3>\n<p>関連記事を出力するコンポーネントrelatedList.jsファイルをcomponents/blogs/に格納します。</p>\n<p><small>※ Imageコンポーネントについては<a href=\"/blogs/entry406/\">投稿ページの充実と画像設定</a>をご覧ください。</small></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link<span class=\"token punctuation\">,</span> StaticQuery<span class=\"token punctuation\">,</span> graphql <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n<span class=\"token keyword\">import</span> Image <span class=\"token keyword\">from</span> <span class=\"token string\">\"../image\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">List</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> item<span class=\"token punctuation\">,</span> url <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">,</span> hero <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> item\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>article <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard c-grid__item--md6 c-grid__item--lg4\"</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Link <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__img\"</span> to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>hero <span class=\"token operator\">?</span> <span class=\"token operator\">&lt;</span>Image filename<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>hero<span class=\"token punctuation\">}</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">> : &lt;Image filename=\"common</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">dummy</span></span><span class=\"token punctuation\">.</span>png\" <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__date\"</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span>date<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">}</span> <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__body\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>h3 <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-entryCard__heading\"</span><span class=\"token operator\">></span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h3<span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>article<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> category<span class=\"token punctuation\">,</span> title<span class=\"token punctuation\">,</span> tags <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>StaticQuery\n      query<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>graphql<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n        query {\n          allMarkdownRemark {\n            edges {\n              node {\n                fields {\n                  slug\n                }\n                id\n                frontmatter {\n                  date(formatString: \"YYYY.MM.DD\")\n                  hero\n                  title\n                  cateId\n                  tags\n                  pagetype\n                }\n              }\n            }\n          }\n        }\n      </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span>\n      render<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">let</span> posts <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n            <span class=\"token punctuation\">(</span><span class=\"token parameter\">post</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// タイトルは除外</span>\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title <span class=\"token operator\">!==</span> title<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// カテゴリーの一致出力</span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>cateId <span class=\"token operator\">===</span> category<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n                    post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>cateId <span class=\"token operator\">===</span> category\n                  <span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n                <span class=\"token comment\">// タグの一致出力</span>\n                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> tag <span class=\"token keyword\">of</span> tags<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> item <span class=\"token keyword\">in</span> post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tag <span class=\"token operator\">===</span> post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n                  <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>posts<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n          <span class=\"token keyword\">function</span> <span class=\"token function\">shuffle</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">list</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> list<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">--</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">var</span> j <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">===</span> j<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">var</span> k <span class=\"token operator\">=</span> list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n              list<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> list<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n              list<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> k<span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n\n            <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n\n          <span class=\"token function\">shuffle</span><span class=\"token punctuation\">(</span>posts<span class=\"token punctuation\">)</span>\n\n          posts <span class=\"token operator\">=</span> posts<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>section <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"p-section l-container is-view\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span>h2 <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"c-heading--lg\"</span><span class=\"token operator\">></span>関連記事もあわせてお読みください<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h2<span class=\"token operator\">></span>\n              <span class=\"token operator\">&lt;</span>div <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"c-grid\"</span><span class=\"token operator\">></span>\n                <span class=\"token punctuation\">{</span>\n\t\t\t\t  posts<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span> <span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>List item<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">}</span> url<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n                  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>section<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"ブログ詳細に関連記事を出力\">ブログ詳細に関連記事を出力</h2>\n<p>コンポーネントを呼び出します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ~省略~</span>\n<span class=\"token keyword\">import</span> RelatedList <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/blogs/relatedList\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">BlogPostTemplate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> location <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ~省略~</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ~省略~</span>\n\t<span class=\"token operator\">&lt;</span>Layout location<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">}</span> title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>siteTitle<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/*~省略~*/</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token operator\">&lt;</span>RelatedList category<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>cateId<span class=\"token punctuation\">}</span> title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span> tags<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">}</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>RelatedList<span class=\"token operator\">></span>\n\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/*~省略~*/</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Layout<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> BlogPostTemplate\n\n<span class=\"token comment\">// ~省略~</span></code></pre></div>\n<p><br>これで関連記事び一覧が出力できるようになりました！わーい。</p>\n<p>読みこむたびに、ランダム表示されます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7d34a97f1b94c2839b55204bd6a4eb26/a2510/entry430-1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.72151898734178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAQBAgMF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB6Vt1hkgP/8QAGxAAAQQDAAAAAAAAAAAAAAAAAgADERIBEyP/2gAIAQEAAQUC7TnYgtSETUi2NG//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAEBAAIDAQAAAAAAAAAAAAABABExAhIhQf/aAAgBAQAGPwL5jN4x23MCu443/8QAGhABAQEAAwEAAAAAAAAAAAAAAREAITFBYf/aAAgBAQABPyHnK8rrueYwW+9YgHfblVXG8pVvOnSs9d//2gAMAwEAAgADAAAAEPfP/8QAFhEBAQEAAAAAAAAAAAAAAAAAERAh/9oACAEDAQE/EFyf/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARMf/aAAgBAgEBPxDDV//EABwQAAIDAQADAAAAAAAAAAAAAAERACExUWFxwf/aAAgBAQABPxDCosIWtx6lYbNghAXkRQKeF2VlYo4GBGHIHDEMmJunyDAqJ6G39n//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7d34a97f1b94c2839b55204bd6a4eb26/81b7c/entry430-1.webp 158w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/6ea66/entry430-1.webp 315w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/8aab1/entry430-1.webp 630w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/a70f5/entry430-1.webp 945w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/a5d4d/entry430-1.webp 1000w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7d34a97f1b94c2839b55204bd6a4eb26/ff44c/entry430-1.jpg 158w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/a6688/entry430-1.jpg 315w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/828fb/entry430-1.jpg 630w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/0ede0/entry430-1.jpg 945w,\n/static/7d34a97f1b94c2839b55204bd6a4eb26/a2510/entry430-1.jpg 1000w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7d34a97f1b94c2839b55204bd6a4eb26/828fb/entry430-1.jpg\"\n            alt=\"関連記事一覧の出力\"\n            title=\"関連記事一覧の出力\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"まとめ・関連記事一覧を実装するとユーザーも嬉しい\">まとめ・関連記事一覧を実装するとユーザーも嬉しい</h2>\n<p>記事詳細読了後、関連記事が表示されることで回遊率はグンと上がります。</p>\n<p>実はリニューアル前も関連記事機能あったんですがロジックが甘くてほぼ機能していませんでした。</p>\n<p>現在はGatsbyに切り替えてしっかり作り込んだおかげで、適切な関連記事が表示されるようになりました。</p>\n<p>Googleアナリティクスで見ても、記事の検索機能もつけたせいかもしれませんが、<em>平均ページ/セッション数が1.2ページからから1.83</em>になり、150%伸びました。嬉しい限り。</p>\n<p>ぜひ、Gatsbyで興味ある方は関連記事の実装チャレンジしてください。</p>\n<p>次回以前ちょっとツイッターで話題にしてもらった404ページの作り方をアイデアも含めて記事にします。</p>\n<p>最後までお読みいただきありがとうございました。</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%E4%BB%8A%E3%81%BE%E3%81%A7%E3%81%AEgatsby%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%A8%E6%B3%A8%E6%84%8F%E7%82%B9\">今までのGatsbyの記事と注意点</a></p>\n<ul>\n<li><a href=\"#%E3%81%93%E3%81%AE%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA%E3%81%A7%E3%81%AF%E3%83%86%E3%83%BC%E3%83%9Egatsby-starter-blog%E3%82%92%E6%94%B9%E9%80%A0\">このシリーズではテーマGatsby Starter Blogを改造</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#staticquery%E3%82%BF%E3%82%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%90%8C%E3%81%98%E3%82%BF%E3%82%B0%E3%81%A8%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%83%BC%E3%81%AE%E8%A8%98%E4%BA%8B%E3%82%92%E7%B5%9E%E3%82%8A%E8%BE%BC%E3%82%80\">StaticQueryタグを使って同じタグとカテゴリーの記事を絞り込む</a></p>\n<ul>\n<li><a href=\"#%E7%B5%9E%E3%82%8A%E8%BE%BC%E3%81%BF%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%9C%E3%82%8B\">絞り込み機能を作る</a></li>\n<li><a href=\"#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B%E3%81%8C%E5%AD%98%E5%9C%A8%E3%81%97%E3%81%9F%E3%82%89%E3%83%A9%E3%83%B3%E3%83%80%E3%83%A0%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B\">関連記事が存在したらランダム出力する</a></li>\n<li><a href=\"#%E7%B5%90%E6%9E%9C%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90\">結果を出力するコンポーネント作成</a></li>\n<li><a href=\"#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B%E3%82%92%E5%87%BA%E5%8A%9B%E3%81%99%E3%82%8B%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E6%9B%B8%E3%81%8F%E3%81%A8\">関連記事を出力するコンポーネントのコードをまとめて書くと</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%E3%83%96%E3%83%AD%E3%82%B0%E8%A9%B3%E7%B4%B0%E3%81%AB%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B%E3%82%92%E5%87%BA%E5%8A%9B\">ブログ詳細に関連記事を出力</a></p>\n</li>\n<li>\n<p><a href=\"#%E3%81%BE%E3%81%A8%E3%82%81%E3%83%BB%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B%E4%B8%80%E8%A6%A7%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%81%A8%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%82%E5%AC%89%E3%81%97%E3%81%84\">まとめ・関連記事一覧を実装するとユーザーも嬉しい</a></p>\n</li>\n</ul>","frontmatter":{"title":"Gatsbyブログサイト移行物語9~関連記事一覧出力~","date":"2021.01.12","description":"今回でGatsbyカスタマイズ9記事！せっかく書いたブログ記事、たくさん読んで欲しいですよね？そこでブログ詳細での関連記事出力のコンポーネントを作ります！","lead":["今回でGatsbyカスタマイズ9記事！せっかく書いたブログ記事、たくさん読んで欲しいですよね？そこでブログ詳細での関連記事出力のコンポーネントを作ります！"],"hero":"2020/entry401.jpg","cateId":"web-developer","tags":["JavaScript","React","Gatsby"],"pagetype":"blog","modifieddate":null}},"previous":{"fields":{"slug":"/blogs/entry429/"},"frontmatter":{"title":"セブ島からNew Normalの帰国の仕方教えます（航空券購入+バランガイ編）"}},"next":{"fields":{"slug":"/blogs/entry431/"},"frontmatter":{"title":"生きるのが楽になる！コーチングから学ぶ5つのメソッド+マインド"}}},"pageContext":{"id":"79d0d7e3-86b0-5a37-8cbd-8d52a0319860","previousPostId":"60ac2a2c-4e33-5d41-8304-c0b52aafe7d8","nextPostId":"84d6f0a9-ca6f-53ee-aced-8ac2c7a115d4","hero":"2020/entry401.jpg"}}