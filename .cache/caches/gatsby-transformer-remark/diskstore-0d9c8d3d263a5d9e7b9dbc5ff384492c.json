{"expireTime":9007200880805333000,"key":"transformer-remark-markdown-html-57ceb0f690886ddd350ae3add8460c3e-gatsby-remark-imagesgatsby-remark-autolink-headersgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h2 id=\"concrete5の設定で気をつけること\">concrete5の設定で気をつけること</h2>\n<p>concrete5では、あらかじめphp.iniや.htaccessで文字コードをUTF-8に設定しておくのは必須です。データベースもutf8_general_ciで新規作成します。これをしておかないとインストール時にカオスになることも。。。</p>\n<p>レンサバなどで簡単インストールなどが付いている場合はそっちでやったほうが失敗は少ないのでおすすめです。</p>\n<p><a href=\"https://concrete5-japan.org/help/5-6/install/gettingready/\">concrete5インストールまでの準備</a></p>\n<h2 id=\"突然の文字化け\">突然の文字化け</h2>\n<p>今回は、X-serverに実装しているconcrete5サイトが文字化けしてしまいました。それまでは通常通り見れていました。sqlデータ落としてファイル開いてみたけど異常なし。</p>\n<p>X-serverはCGI版でphp.iniを変更することができます。</p>\n<p>サーバー内を確認すると.htaccessとphp.iniが更新されている形跡が。。。エンコードもなぜかEUCになっておりなぜこんなことになったのかが分からず、とりあえずUTF-8に変えて更新。それでも相変わらず文字化けが直らない。</p>\n<p>うちの会社で運用しているサイトではないですが、とても付き合いの長い方のお客様だったので早く解決してあげたいし、原因は分からないし途方に暮れていると、concrete5側でデータベース設定ができることを思い出しました。</p>\n<h2 id=\"concrete5側でデータベースのdriveroptionsを修正\">concrete5側でデータベースのdriverOptionsを修正</h2>\n<p>concrete5にはapplication/config/内にdatabase.phpというファイルがあり、ここにデータベースの設定があります。ここでMySQLを読み込むドライバーのオプション設定を変えることができます。</p>\n<p><a href=\"https://qiita.com/hiro_y/items/6fabdef669e35e92bdc4\">MySQLとPDOの組み合わせでcharsetを指定する</a></p>\n<p>concrete5でのデフォルトのドライバーはPDOが指定されてます。以下のコードを追加します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">'driverOptions' => array(PDO::MYSQL_ATTR_INIT_COMMAND => 'SET NAMES utf8')</code></pre></div>\n<p>MYSQL_ATTR_INIT_COMMANDの文字コードをutf8にセット。場合によってはutf8だけでいい場合も。</p>\n<p>まずはMySQLの文字コードをよく確認してみてください。</p>\n<h2 id=\"とりあえずは一件落着\">とりあえずは一件落着</h2>\n<p>最近、大きなアップデートがあったことで思い当たる節は、WAFに対応？PHPのバージョン?結局、なんで急に文字化けしたのかは分からないです。。。。</p>\n<p>もしみなさんも困った時はやってみてください。</p>"}