{"expireTime":9007200880808503000,"key":"transformer-remark-markdown-html-c0e4b4d468f8fbf0f4a53d16a53a849a-gatsby-remark-imagesgatsby-remark-autolink-headersgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h2 id=\"デフォルトでも十分優秀なページリストブロック\">デフォルトでも十分優秀なページリストブロック</h2>\n<p>ページリストブロックはデフォルトでもとても優秀なブロックで、記事の一覧を出力するのによく重宝します。</p>\n<p>多少、コードは書かないといけませんが、その学習コストを入れても十分使えます。</p>\n<h3 id=\"デフォルトのテンプレートで主にできること\">デフォルトのテンプレートで主にできること</h3>\n<ul>\n<li>親ページで絞り込み</li>\n<li>ページタイプで絞り込み</li>\n<li>タグで絞り込み</li>\n<li>トピックスで絞り込み</li>\n<li>並び替え</li>\n<li>日付で表示・非表示ページをコントロール</li>\n<li>ページネーション</li>\n</ul>\n<p>任意の属性で絞り込みをする\nページリストブロックには変数<code class=\"language-text\">$list</code>の中に管理画面で設定した絞り込みの値が入ったものが渡ってます。</p>\n<p>$list->getResults(); で結果を配列で出力でき<code class=\"language-text\">$pages</code>に格納されています。</p>\n<p>なので一旦、 <code class=\"language-text\">filterByAttribute();</code> で属性での絞り込みを追加して、再度<code class=\"language-text\">$list->getResults();</code> で絞り込み結果を再度 $pages（同じ変数名がやな人は変えてね）に代入すれば最小限の労力でカスタマイズできます。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$list->filterByAttribute(【属性名】, 【値】, \"=\");</code></pre></div>\n<p>ナビを出力したら以下のコードで絞り込みを追加します。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">if (isset($_GET['value']) {\n    //属性ハンドル取得\n    $attrSet = h($_GET['attr']);\n\n\tforeach ($optionList as $key ) {\n\n        if($key->value == h($_GET['value'])){\n            // ジャンル名が同じものを出力\n            $list->filterByAttribute($choumeiSet, $key->value, \"=\");\n            break;\n        }\n    }\n\n    $pages = $list->getResults();\n}</code></pre></div>\n<p>あとは通常通り、 <code class=\"language-text\">$pages</code> を <code class=\"language-text\">foreach</code> で回せば絞り込みは完成です。ページネーションも変更する必要はありません。</p>\n<h2 id=\"おまけ\">おまけ</h2>\n<p>オプションリストで出力するともっと簡単\nちなみにオプションリスト(<code class=\"language-text\">&lt;select></code>とか<code class=\"language-text\">&lt;option></code>)で出力する場合は、以下のコードでもいけます。</p>\n<p>勝手に出力してくれるのでめちゃめちゃ便利です。\nただしどんなコードがあらかじめ出力されるか把握した上で、コーディングしないと泣く羽目に遭いますよ。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ak = CollectionAttributeKey::getByHandle('genre');\n$ak->render('search');</code></pre></div>\n<h3 id=\"複数の属性をまとめて扱いたいならセットに登録しよう\">複数の属性をまとめて扱いたいならセットに登録しよう</h3>\n<p>ページ属性はまとめてセットに登録することが可能です。\n登録したデータをまとめて foreach で回せるので便利です。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$choumei_set = AttributeSet::getByHandle('[セット名]')->getAttributeKeys();</code></pre></div>\n<h2 id=\"まとめ\">まとめ</h2>\n<p>実際に私が実装したのは複数の属性を作って絞り込んだのでもっと複雑でしたが、このくらいミニマムなものを改造してチャレンジすると敷居が低くて良いと思います。\nもちろん、いろんな種類の属性でできます！\n以下公式サイトのURLを見ながら、ぜひやってみるといいと思います。</p>\n<h3 id=\"参考サイト\">参考サイト</h3>\n<p><a href=\"https://concrete5-japan.org/help/5-7/developer/working-with-pages/searching-and-sorting-with-the-pagelist-object/\">PageList オブジェクトで検索・ソートを行う</a></p>"}