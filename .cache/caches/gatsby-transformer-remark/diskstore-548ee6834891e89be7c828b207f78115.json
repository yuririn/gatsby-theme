{"expireTime":9007200880808528000,"key":"transformer-remark-markdown-html-3aad1cb5e79c2022b7c3ff4694d89109-gatsby-remark-imagesgatsby-remark-autolink-headersgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h2 id=\"この記事でできること\">この記事でできること</h2>\n<p>前提条件はある程度カスタムフィールドやカスタム投稿の追加の仕方やある程度カスタマイズできることです。</p>\n<p>できることは以下です。</p>\n<ul>\n<li>カスタム投稿などのタイトルを値としてフォームに自動挿入する</li>\n<li>セレクトボックスの値を自動で出力する</li>\n</ul>\n<h2 id=\"プラグインmw-wp-formとは？\">プラグインMW WP Formとは？</h2>\n<p>MW WP FormはWordPressのフォーム専用プラグインです。お問い合わせ内容をデータベースに保存したり、無料で使えるのに何かと高機能です。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5a1429b708ee9a0f0f863f56042beb76/a2510/entry435-2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAEDBQT/xAAVAQEBAAAAAAAAAAAAAAAAAAADAv/aAAwDAQACEAMQAAABdFOiwZoUkEJIs//EABsQAAIBBQAAAAAAAAAAAAAAAAIDARASEyBC/9oACAEBAAEFAuoUZUXNr84a/wD/xAAYEQEAAwEAAAAAAAAAAAAAAAACARARMf/aAAgBAwEBPwEk5RSiO1//xAAXEQEBAQEAAAAAAAAAAAAAAAABEAIR/9oACAECAQE/AXT2IT//xAAfEAABAgYDAAAAAAAAAAAAAAABABECEBIgMTJBcZH/2gAIAQEABj8CpAJK1buQiOGXPlv/xAAaEAEBAAIDAAAAAAAAAAAAAAABEQAhECBx/9oACAEBAAE/IRUpJYZa3ydMyEHeU4r3p//aAAwDAQACAAMAAAAQFwd+/8QAGREBAAIDAAAAAAAAAAAAAAAAAQAQETGB/9oACAEDAQE/EFBWO5hAjtf/xAAYEQEBAAMAAAAAAAAAAAAAAAABABARMf/aAAgBAgEBPxA6Ajkp2mP/xAAcEAEAAwACAwAAAAAAAAAAAAABABExEHEhUWH/2gAIAQEAAT8QVMgiYdsMtQ9gvqlgsWjU8LigLpmNAr7haDp2Jc3eP//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5a1429b708ee9a0f0f863f56042beb76/81b7c/entry435-2.webp 158w,\n/static/5a1429b708ee9a0f0f863f56042beb76/6ea66/entry435-2.webp 315w,\n/static/5a1429b708ee9a0f0f863f56042beb76/8aab1/entry435-2.webp 630w,\n/static/5a1429b708ee9a0f0f863f56042beb76/a70f5/entry435-2.webp 945w,\n/static/5a1429b708ee9a0f0f863f56042beb76/a5d4d/entry435-2.webp 1000w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5a1429b708ee9a0f0f863f56042beb76/ff44c/entry435-2.jpg 158w,\n/static/5a1429b708ee9a0f0f863f56042beb76/a6688/entry435-2.jpg 315w,\n/static/5a1429b708ee9a0f0f863f56042beb76/828fb/entry435-2.jpg 630w,\n/static/5a1429b708ee9a0f0f863f56042beb76/0ede0/entry435-2.jpg 945w,\n/static/5a1429b708ee9a0f0f863f56042beb76/a2510/entry435-2.jpg 1000w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5a1429b708ee9a0f0f863f56042beb76/828fb/entry435-2.jpg\"\n            alt=\"WordPressのフォーム専用プラグインMW WP Form\"\n            title=\"WordPressのフォーム専用プラグインMW WP Form\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>自作したフォームはショートコードを貼るだけで実装できます。</p>\n<p><a href=\"https://plugins.2inc.org/mw-wp-form/\">プラグインページMW WP Form</a></p>\n<p>今回はフォームの作り方や実装の仕方は割愛します。</p>\n<h2 id=\"フォームに値を渡す方法はmw-wp-formに用意されている\">フォームに値を渡す方法はMW WP Formに用意されている</h2>\n<p>早速フォームに値を渡す方法です。</p>\n<p>MW WP FormではURLのパラメーター（引数）を使って値を渡すことができます。</p>\n<p>設定項目から、「<em>URL引数を有効にする</em>」へチェックを入れておきます。</p>\n<p>チェックを入れてない場合、引数はページ遷移した時に消去されます。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/894867e120f96c5f84a7157ff3d5454c/41099/entry435-1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 192.40506329113924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAmABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe3oaDKmyQAAf//EABkQAAIDAQAAAAAAAAAAAAAAAAARARAgQf/aAAgBAQABBQIdrPScf//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BX//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BX//EABYQAAMAAAAAAAAAAAAAAAAAACAwQf/aAAgBAQAGPwIqn//EAB4QAAIBBAMBAAAAAAAAAAAAAAABERAxQXEhUYFh/9oACAEBAAE/IZhveRdlSE8M0YxyI+sYubFS49PRn//aAAwDAQACAAMAAAAQcAo8cA//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EF//xAAfEAEAAgICAgMAAAAAAAAAAAABABEhMWFxQVEQkfH/2gAIAQEAAT8QGAL5NdcQdBfEUaQq4s2Z2VKdHU8MViBNmJ6SmWQwfUNIXeJsGBq/Mv4M8M+oX+IrZ//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/894867e120f96c5f84a7157ff3d5454c/81b7c/entry435-1.webp 158w,\n/static/894867e120f96c5f84a7157ff3d5454c/6ea66/entry435-1.webp 315w,\n/static/894867e120f96c5f84a7157ff3d5454c/b0a15/entry435-1.webp 500w\"\n              sizes=\"(max-width: 500px) 100vw, 500px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/894867e120f96c5f84a7157ff3d5454c/ff44c/entry435-1.jpg 158w,\n/static/894867e120f96c5f84a7157ff3d5454c/a6688/entry435-1.jpg 315w,\n/static/894867e120f96c5f84a7157ff3d5454c/41099/entry435-1.jpg 500w\"\n            sizes=\"(max-width: 500px) 100vw, 500px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/894867e120f96c5f84a7157ff3d5454c/41099/entry435-1.jpg\"\n            alt=\"URL引数の使い方\"\n            title=\"URL引数の使い方\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>引数は値をそのまま渡せます。</p>\n<blockquote>\n<p>有効にした場合、MW WP FormはURL引数を取得します。また、URL引数 ”post_id” をもとに投稿を取得します。その投稿（$post） のプロパティを使用できるようになります。</p>\n<p>例：{ID}、{post_title}、{post_meta}など…</p>\n</blockquote>\n<p>たとえば、遷移前のページ情報を取得したい場合。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;a href=\"&lt;?php bloginfo('url')/contact/?post_id=&lt;?php echo get_the_ID();?>\"></code></pre></div>\n<p>MW WP From設定側はこんな感じ。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[mwform_text name=\"name\" value=\"{post_title}\"]</code></pre></div>\n<p>ここまではググればソッコーでわかりますが、当時私がやりたかったのはあるページのカスタムフィールドなどの値を加工して一部だけ取得するというものです。</p>\n<h2 id=\"習い事などのコース詳細ごとの申し込みフォームを作る\">習い事などのコース詳細ごとの申し込みフォームを作る</h2>\n<p>ある習い事の膨大な日程表から選んだ日時の予定に申し込みをするという設定を作らなければなりませんでした。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7a3891fd93b02e204a90e379d71235d2/4b190/entry435-3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEBf/EABQBAQAAAAAAAAAAAAAAAAAAAAP/2gAMAwEAAhADEAAAAaroNFQQYB//xAAZEAEAAgMAAAAAAAAAAAAAAAABAAIQEjL/2gAIAQEAAQUClQ1AxTkn/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAEDMf/aAAgBAwEBPwGejR//xAAWEQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAIAQIBAT8B2lf/xAAYEAADAQEAAAAAAAAAAAAAAAAAASEQcf/aAAgBAQAGPwIUHMQ+n//EABsQAAEEAwAAAAAAAAAAAAAAAAABETFRECGh/9oACAEBAAE/IRc4iKHWiaxxEy//2gAMAwEAAgADAAAAECv/AP/EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQMBAT8QIrYN5f/EABgRAAIDAAAAAAAAAAAAAAAAAAABESEx/9oACAECAQE/EKpDI0//xAAbEAEAAgIDAAAAAAAAAAAAAAABACEQoRGBwf/aAAgBAQABPxDsj2lRbC+WthTGum08n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7a3891fd93b02e204a90e379d71235d2/81b7c/entry435-3.webp 158w,\n/static/7a3891fd93b02e204a90e379d71235d2/6ea66/entry435-3.webp 315w,\n/static/7a3891fd93b02e204a90e379d71235d2/8aab1/entry435-3.webp 630w,\n/static/7a3891fd93b02e204a90e379d71235d2/d00b9/entry435-3.webp 800w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7a3891fd93b02e204a90e379d71235d2/ff44c/entry435-3.jpg 158w,\n/static/7a3891fd93b02e204a90e379d71235d2/a6688/entry435-3.jpg 315w,\n/static/7a3891fd93b02e204a90e379d71235d2/828fb/entry435-3.jpg 630w,\n/static/7a3891fd93b02e204a90e379d71235d2/4b190/entry435-3.jpg 800w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7a3891fd93b02e204a90e379d71235d2/828fb/entry435-3.jpg\"\n            alt=\"URL引数の使い方\"\n            title=\"URL引数の使い方\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>教室は拠点だけで10個前後あり、学べるコースも6種類くらいありました。開催している時間帯が曜日などの数が拠点によってかなり違いました。</p>\n<p>教室はカスタム投稿の1投稿として登録すればいいとして、クラス名や時間帯などを1個づつカスタムフィールドに入力するのはクライアント側もしんどいと考えました。</p>\n<h3 id=\"遷移元から値を渡せるようにする\">遷移元から値を渡せるようにする</h3>\n<p>なので入力規則を決めて以下のようにdetailという名前のカスタムフィールドへ登録してもらうことにしました。</p>\n<p>コース・曜日・時間帯の詳細を|(パイプ)でくぎり、それぞれ改行して入力してもらうようルールを決めました。</p>\n<p>今回は<em>detail</em>というカスタムフィールドに格納します。</p>\n<p>カスタムフィールドは自作しても、<a href=\"https://ja.wordpress.org/plugins/advanced-custom-fields/\">プラグインAdvanced Custom Fields</a>を使ってもいいと思います。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">コースA|第1・第3土曜|13:00～14:30\nコースA|第2・第4土曜|13:00～14:30\nコースB|第2・第4土曜|13:00～14:30\nコースC|第1・第3日曜|13:00～14:30</code></pre></div>\n<p>フォームではURL引数にコース詳細の行（何番目か）とIDを渡します。\nカスタムフィールドに格納された値はメソッド<code class=\"language-text\">explode()</code>を使って配列化します。</p>\n<blockquote>\n<p>explode()は文字列を文字列により分割するメソッド。</p>\n<p><a href=\"https://www.php.net/manual/ja/function.explode.php\">PHPマニュアル　explode</a></p>\n</blockquote>\n<p>同じ名前のコースはセルを結合したかったのでちょっとコードが複雑です。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">    <span class=\"token comment\">/* カスタムフィールドdetailを取得し改行で分割し配列化 */</span>\n    <span class=\"token variable\">$detail</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'detail'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$detail</span> <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$detail</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/* 後ほどコードを格納するために空の変数を用意 */</span>\n    <span class=\"token variable\">$table</span>  <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">&lt;=</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$detail</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span><span class=\"token variable\">$i</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">&lt;</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$detail</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$th</span> <span class=\"token operator\">!=</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token operator\">&amp;</span> <span class=\"token variable\">$th</span> <span class=\"token operator\">!=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$detail</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$i</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token variable\">$ths</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$th</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$cnt</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$th</span> <span class=\"token operator\">!=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$detail</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$i</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token variable\">$th</span>  <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$detail</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$i</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                <span class=\"token variable\">$cnt</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$ths</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$th</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$cnt</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token operator\">++</span><span class=\"token variable\">$cnt</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\">/* 初期化 */</span>\n    <span class=\"token variable\">$cousename</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$cnt</span>       <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$detail</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$key</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$value</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$tag</span>     <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$value</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$table</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;tr class=\"add-bottom-border\">'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$cousename</span> <span class=\"token operator\">!=</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$col</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$ths</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$cnt</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token variable\">$col</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">' rowspan=\"'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$ths</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$cnt</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'\"'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token variable\">$table</span>   <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;th'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$col</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'>'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/th>'</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$cousename</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token operator\">++</span><span class=\"token variable\">$cnt</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token variable\">$table</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;td>'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/td>'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$table</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;td>'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/td>'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">/* ページのIDとコース詳細の行番号を渡す */</span>\n        <span class=\"token variable\">$table</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;td>&lt;a href=\"'</span> <span class=\"token operator\">.</span> <span class=\"token function\">home_url</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'/entry'</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'?post_id='</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$post_id</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&amp;line='</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$key</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'\">入会申込&lt;/a>&lt;/td>'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$table</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'&lt;/tr>'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>あとは変数<code class=\"language-text\">$table</code>に格納された値をhtmlとして出力するだけ。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>thead</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>コース名<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>開催週<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>クラス名（時間）<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span><span class=\"token punctuation\">></span></span>入会<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>thead</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tbody</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token prolog\">&lt;?php echo $table; ?></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tbody</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>table</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>入会申し込みボタンからそれぞれの教室やコース詳細の引数を遷移先のフォームへ渡せるようになります。</p>\n<h3 id=\"遷移先のフォームに値を渡すコードを書く\">遷移先のフォームに値を渡すコードを書く</h3>\n<p>functions.phpへ受け取ったパラメーターを元にデータを各フォームへ値を渡すコードを書きます。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">mwform_value</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$name</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token operator\">!</span> <span class=\"token keyword\">empty</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'post_id'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span> <span class=\"token function\">is_array</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'post_id'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">get_post</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'post_id'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'line'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'line'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">/* 行番号取得 */</span>\n            <span class=\"token variable\">$order</span>     <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'line'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">/* ページIDが一致するdetail取得 */</span>\n            <span class=\"token variable\">$details</span>   <span class=\"token operator\">=</span> <span class=\"token function\">get_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'post_id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'detail'</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">/* 改行で分割し配列化し、必要な行を取り出す */</span>\n            <span class=\"token variable\">$detail</span>    <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span> <span class=\"token string double-quoted-string\">\"\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$details</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$order</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">/* |で分割し配列化 */</span>\n            <span class=\"token variable\">$detail</span>    <span class=\"token operator\">=</span> <span class=\"token function\">explode</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'|'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$detail</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">/* 書く値を格納 */</span>\n            <span class=\"token variable\">$course</span>    <span class=\"token operator\">=</span> <span class=\"token variable\">$detail</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$date</span>      <span class=\"token operator\">=</span> <span class=\"token variable\">$detail</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$classname</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$detail</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$name</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'course'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token variable\">$course</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$name</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'date'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token variable\">$date</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$name</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'classname'</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token variable\">$classname</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$value</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 管理画面で作成したフォームの場合、フック名の後のフォーム識別子は「mw-wp-form-xxx」</span>\n<span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'mwform_value_mw-wp-form-xxxx'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'mwform_value'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><br><em>関数名 + _ + mw-wp-form-xxx</em>で<code class=\"language-text\">add_filter</code>を使ってフックさせます。<br>\nxxxはフォームのIDです。</p>\n<p>ショートコードの<em>keyの値</em>がそれに当たります。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aaa669d7d85592d6945185d2fff5e96c/4b190/entry435-4.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAACABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAduwSD//xAAVEAEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABBQIv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhABAQEAAAAAAAAAAAAAAAAAAAEx/9oACAEBAAE/IdKmP//aAAwDAQACAAMAAAAQcA//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQMBAT8QEX//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAZEAACAwEAAAAAAAAAAAAAAAABEQAQITH/2gAIAQEAAT8QIqHk5q//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/aaa669d7d85592d6945185d2fff5e96c/81b7c/entry435-4.webp 158w,\n/static/aaa669d7d85592d6945185d2fff5e96c/6ea66/entry435-4.webp 315w,\n/static/aaa669d7d85592d6945185d2fff5e96c/8aab1/entry435-4.webp 630w,\n/static/aaa669d7d85592d6945185d2fff5e96c/d00b9/entry435-4.webp 800w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/aaa669d7d85592d6945185d2fff5e96c/ff44c/entry435-4.jpg 158w,\n/static/aaa669d7d85592d6945185d2fff5e96c/a6688/entry435-4.jpg 315w,\n/static/aaa669d7d85592d6945185d2fff5e96c/828fb/entry435-4.jpg 630w,\n/static/aaa669d7d85592d6945185d2fff5e96c/4b190/entry435-4.jpg 800w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/aaa669d7d85592d6945185d2fff5e96c/828fb/entry435-4.jpg\"\n            alt=\"URL引数の使い方\"\n            title=\"URL引数の使い方\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>これでname属性へ値がそのまま渡り、自動で格納されます。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dt</span><span class=\"token punctuation\">></span></span>コース名<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dt</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dd</span><span class=\"token punctuation\">></span></span>[mwform_text name=\"course\" placeholder=\"コース名\"]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dd</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dt</span><span class=\"token punctuation\">></span></span>開催週<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dt</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dd</span><span class=\"token punctuation\">></span></span>[mwform_text name=\"date\" placeholder=\"開催週\"]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dd</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dt</span><span class=\"token punctuation\">></span></span>クラス名（時間）<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dt</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dd</span><span class=\"token punctuation\">></span></span>[mwform_text name=\"classname\" placeholder=\"クラス名（時間）\"]<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dd</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>もし入力された値を自由に変更されたくなかったら、HTMLの<code class=\"language-text\">readonly</code>属性でコントロールしてあげると良いかもです。</p>\n<blockquote>\n<p>readonly属性は、入力コントロールに対する変更を禁止にするための属性です。</p>\n</blockquote>\n<p>一応コードを記載しておきます。テストしていないので、動くかどうかはご自身で確認してください。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">my_mwform_input_shortcode_tag</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$output</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$tag</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$attr</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$tag</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'mwform_input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$attr</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'course'</span> <span class=\"token operator\">||</span>  <span class=\"token variable\">$attr</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'date'</span> <span class=\"token operator\">||</span>  <span class=\"token variable\">$attr</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string single-quoted-string\">'classname'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token variable\">$output</span> <span class=\"token operator\">=</span> <span class=\"token function\">str_replace</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;input '</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'&lt;input readonly '</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$output</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$output</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'do_shortcode_tag'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'my_mwform_input_shortcode_tag'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"https://ja.wordpress.org/support/topic/mw-wp-form%E3%81%A7textarea%E3%81%ABreadonly%E5%B1%9E%E6%80%A7%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B/\">MW WP Formでtextareaにreadonly属性を追加する</a></p>\n<h3 id=\"教室項目のセレクトボックスの値を自動生成し出力する\">教室項目のセレクトボックスの値を自動生成し出力する</h3>\n<p>次にやりたかったのが、セレクトボックスの値を選択項目として自動出力するというものでした。</p>\n<p>この場合、教室はclassroomという名前のカスタム投稿を使っていて、投稿タイトルがそのまま教室名になっています。</p>\n<p>すべてのカスタム投稿を<code class=\"language-text\">get_posts</code>で取得し、タイトルを$children配列に格します。<em>school</em>というname属性のオームがあった時に格納します。</p>\n<p><em>mwform_choices_mw-wp-form-xxx</em>（xxxはフォームのID）を<code class=\"language-text\">add_filter</code>を使ってフックできます。。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function-definition function\">add_school_list</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$children</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$atts</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'school'</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$atts</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'name'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token variable\">$classroom</span> <span class=\"token operator\">=</span> <span class=\"token function\">get_posts</span><span class=\"token punctuation\">(</span>\n\t\t\t<span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'post_type'</span>      <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'classroom'</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token string single-quoted-string\">'posts_per_page'</span> <span class=\"token operator\">=></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token variable\">$children</span>  <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$classroom</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$item</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token variable\">$children</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$item</span><span class=\"token operator\">-></span><span class=\"token property\">post_title</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token variable\">$children</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">add_filter</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'mwform_choices_mw-wp-form-xxx'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'add_school_list'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>フォームに以下のコードを書いて格納完了。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[mwform_select name=\"school\"]</code></pre></div>\n<p>JSでselected属性を付与します。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">  <span class=\"token prolog\">&lt;?php $current = get_the_title( $_GET['post_id'] );?></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n\t\t<span class=\"token keyword\">var</span> classes <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"school\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> classes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> i<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> classes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"' . $current . '\"</span><span class=\"token punctuation\">)</span> classes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>selected <span class=\"token operator\">=</span> <span class=\"token string\">\"selected\"</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"まとめ\">まとめ</h2>\n<p>ちょっと長くなりましたが、遷移元からURL引数を使って任意の値をフォームに入力できるようにカスタマイズしました。</p>\n<p>もう少し、整理して短くかけるとは思いますが、まずは以前書いたまんまをそのまま出します。</p>\n<p>この記事が皆さんのWordPressライフの一助となれば幸いです。</p>\n<p>最後までお読みいただきありがとうございました。</p>"}