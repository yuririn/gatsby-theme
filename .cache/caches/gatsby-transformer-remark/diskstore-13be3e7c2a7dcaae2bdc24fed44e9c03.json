{"expireTime":9007200880808518000,"key":"transformer-remark-markdown-html-c4440a2f42a4aa1e2f5410d7d3858f5a-gatsby-remark-imagesgatsby-remark-autolink-headersgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h2 id=\"recaptcha-とは？\">reCAPTCHA とは？</h2>\n<p>みなさん、このスクショの右下のラベル見たことありますか？</p>\n<p>これ、reCAPTCHA v3と言います。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 498px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7f034c585874709cfed1ad4096e4d5c4/79e1b/entry402-0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 113.9240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAACyElEQVQ4y41V2WoUURDt3/JZBB988tk/EUFQoqAYCfiQP1AIokiUBDWgBJcQAgYJSZh0z/T0OreXe3tfj9QdezLOYqag6Gqm+tSpdRT8R9q2XapN06Cu64mSGIYBpSgKXFxcIAxDcM4RxxFUVcfe3k/p1DQtrhIKoA05VE2HUpYlGGNIkgR5nqMsC/h+iF5vIJ3rupFsrtI0q6APh1AIfTZaJ+TYtqsBkpimCWW6VrO1W1U6X8uyxgxn9aqGLPtmwnBZxFVYTduO41wCTjMj4TzGaOTD80L4gYDnh7JZ9F6W1VwWXc2VRXNHkucFLGskQW3dhj8KEIQChuGiKMqlLBcy5DyC4zDJhGzBQnAvRJrmk1GaZdnZyqJmHBwcY3v7C05PVezvH+Hg8Dd+HZ/h7ExDv2/CNF30evrC5i3t8qrjMge42PFy5abxVwmmJEkq06D6UCqDgYUkjhEJITVLE6RpiizLIUSMOE5lU8Z19iaNYyxAVdVQgkBIoDAUclQs04U6jHCmCfT6HOcah+VwMOZD1+0JAE0BjQmB0D0glQxd15Po5EgfkLNhRxhaAgMjHNsGk4C2zWTwjhG9k01ZUobUeYV+cF1fAmqaIZ++F0BwIS9P21QyXUqT2HR2l7LvcyRJJkGrqoJC1PMsA93FqixlnaIolU6r3MK5pjhegt4ggO1SmnzpWBD4fID5gEoaxAhZhCSrEGflwh0dP9vLLanGWtUNCmpKPbblLqdRgpHD0NB+Jtm/g/cXjC75x6MA3w4NvPzO8OCthSfvbfl8vuPg0TsLd7dMrH+woFBRT05VCMdHpJqoilL+6XQjQQFEnOLV7gk+fz3H2jbDjWcD3FzXcWtDx+0XQ1x/OsC1tT7ubPahCMHlWVI1A7rhyCEnpS7SLlPnaLCZY6BIQ2z9YHj4xsDjdwY2dm1s7Ni4/1rHva0hNj/Z+AMUTen60yIeVAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7f034c585874709cfed1ad4096e4d5c4/81b7c/entry402-0.webp 158w,\n/static/7f034c585874709cfed1ad4096e4d5c4/6ea66/entry402-0.webp 315w,\n/static/7f034c585874709cfed1ad4096e4d5c4/71ce1/entry402-0.webp 498w\"\n              sizes=\"(max-width: 498px) 100vw, 498px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7f034c585874709cfed1ad4096e4d5c4/c26ae/entry402-0.png 158w,\n/static/7f034c585874709cfed1ad4096e4d5c4/6bdcf/entry402-0.png 315w,\n/static/7f034c585874709cfed1ad4096e4d5c4/79e1b/entry402-0.png 498w\"\n            sizes=\"(max-width: 498px) 100vw, 498px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7f034c585874709cfed1ad4096e4d5c4/79e1b/entry402-0.png\"\n            alt=\"プラスマークからreCAPCHAを追加したいサイトを設定\"\n            title=\"プラスマークからreCAPCHAを追加したいサイトを設定\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<blockquote>\n<p>reCAPTCHA（リキャプチャ）とは、ウェブサイトの制限エリアへのアクセスを試みるボットからサイトを防御するためCAPTCHAを利用するのと同時に、そのCAPTCHAに対する返答を紙の本のデジタル化に活かすシステムである。<br>\n<a href=\"https://ja.wikipedia.org/wiki/ReCAPTCHA\">reCAPTCHA | Wikipedia</a></p>\n</blockquote>\n<p>我々の使い道としてはボットを排除して、<strong>スパムからあなたのサイトを守ってくれるありがたい無料サービス</strong>です。</p>\n<p>「私はロボットではありません」<br>\n「何個信号あるか選べ」</p>\n<p>みなさん経験あるんじゃないでしょうか？<br>\n↓↓↓こいつ、結構イライラしますよねww↓↓↓</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 310px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/23e23cf1bdea72c7e404884c7fe050e0/5fad2/entry402-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQY01XPy07CUBAG4D65j+EruHRPlLrwQjVRgxIsiOVSWmhETmfOzJkzp0QDShO/xeTPbGb+SI787/TivT8E3wYRcUfqnaoPwTNzZIwBAEQERCZCAPO1JaL9BgABjTHMLCLs5LuRTt+fnA4Gw7JpfCQiITTTyXt80U3uei/916fH51mW5YtZcv8QX8ZJL6mqSlWZXRO0c5uenSdv42q30wgRiWhdlnH36ub6bj7PQ1DnWP3+MURsK6gqWbuYfUzGQ4CttTZiZuccEQGgtRatbduKiKo65w4HrLW02Xzm+bIsVlk2NXUd0R9u0X91XRdFUVXVclmYGtarVZqORuloa8wPV+NN9yl8mc4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/23e23cf1bdea72c7e404884c7fe050e0/81b7c/entry402-1.webp 158w,\n/static/23e23cf1bdea72c7e404884c7fe050e0/cb91f/entry402-1.webp 310w\"\n              sizes=\"(max-width: 310px) 100vw, 310px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/23e23cf1bdea72c7e404884c7fe050e0/c26ae/entry402-1.png 158w,\n/static/23e23cf1bdea72c7e404884c7fe050e0/5fad2/entry402-1.png 310w\"\n            sizes=\"(max-width: 310px) 100vw, 310px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/23e23cf1bdea72c7e404884c7fe050e0/5fad2/entry402-1.png\"\n            alt=\"私はロボットではありません\"\n            title=\"私はロボットではありません\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>こちらはちなみにreCAPCHA v2の方です。</p>\n<p>サイトを守るために必要なサービスです。<br>\nGoogleも親切で<strong>タダで使わせて使わせもらえる</strong>のでぜひ実装してみたらいいと思います！！</p>\n<h2 id=\"実装するために必要なスキル\">実装するために必要なスキル</h2>\n<p>実装するためには以下必要です。</p>\n<p>多少知見があれば、多分そんなに難しくないです^ ^<br>\n<strong>四則演算子ができて、関数ぐらい使えれば余裕で実装できる</strong>と思います。多分。</p>\n<ul>\n<li>フロントのコーディングスキル</li>\n<li>PHP&#x26;JS知識</li>\n<li>基本のプログラミングスキル</li>\n</ul>\n<h2 id=\"concrete5へのrecapchaの実装手順\">concrete5へのreCAPCHAの実装手順</h2>\n<p>外部フォームブロックでフォームを実装していることが前提です。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/application/\n  - blocks/\n    - external_form/\n      contact_form.php\n      - controller/\n        contact_form.php</code></pre></div>\n<p>contact_formという外部ブロックを作ったのであればこんな構造になります。</p>\n<p>外部フォームの実装方法は↓↓↓こちら↓↓↓<br>\n<a href=\"/blogs/entry236\">コンクリの外部フォームでお問い合わせフォーム作ったよ</a></p>\n<h3 id=\"googleアカウントからトークン発行\">Googleアカウントからトークン発行</h3>\n<p>Admine Consoleから新しいサイトの設定をしてトークンを発行しましょう。</p>\n<p><a href=\"https://www.google.com/recaptcha/about/\">reCAPCHA</a></p>\n<p>右端のプラスマークからreCAPCHAを追加したいサイトを設定します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17144c1f5e2a431169dc54317339d783/00d43/entry402-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.658227848101264%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjElEQVQI123ESwrCMBQAwJzOtOBavFIibgRvYv2Ai4Bd+AFRGtreQNRVmiZ5L02J6FKFYchopsfzdjhtKdfpRFPeUKZSrhKmEv42YP9R1pC8hvXpme1vy+MjO9xFYUTpF2fcSlxdYHOFvPa/dhUKaQj4YCwY6z4DYAe+Ny44DBaCxYBd/wV8iDHKsnoBAdOQAH6p+DIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/17144c1f5e2a431169dc54317339d783/81b7c/entry402-2.webp 158w,\n/static/17144c1f5e2a431169dc54317339d783/6ea66/entry402-2.webp 315w,\n/static/17144c1f5e2a431169dc54317339d783/8aab1/entry402-2.webp 630w,\n/static/17144c1f5e2a431169dc54317339d783/a70f5/entry402-2.webp 945w,\n/static/17144c1f5e2a431169dc54317339d783/a5d4d/entry402-2.webp 1000w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/17144c1f5e2a431169dc54317339d783/c26ae/entry402-2.png 158w,\n/static/17144c1f5e2a431169dc54317339d783/6bdcf/entry402-2.png 315w,\n/static/17144c1f5e2a431169dc54317339d783/f058b/entry402-2.png 630w,\n/static/17144c1f5e2a431169dc54317339d783/40601/entry402-2.png 945w,\n/static/17144c1f5e2a431169dc54317339d783/00d43/entry402-2.png 1000w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/17144c1f5e2a431169dc54317339d783/f058b/entry402-2.png\"\n            alt=\"プラスマークからreCAPCHAを追加したいサイトを設定\"\n            title=\"プラスマークからreCAPCHAを追加したいサイトを設定\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>サイトのドメインなど、サイトの設定します。</p>\n<p>今回はreCAPTHA v3を選びます。<br>\nドメインを追加し、オーナーにgmailを設定。<br>\n利用条件の同意にチェックを入れ、送信をします。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 629px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9b44e7db92a6d6bad269353e42ab6be/63a68/entry402-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 117.72151898734178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDUlEQVQ4y5WU3YrTQBTH+zbirbeieOETqVfeiCi+gOCNiyKIryC6iy7C+gAWqvXOLUlpdjrJTObzzJw5kmSbZre1rT/ORRLyz/mfj8no9hN+/wW/85Tfe87vPuO3HvMbD/nNRwfF6O039f67fnMqXn26eP2lOvpaH53qA2NELYgheonBJox0MKMQU4jJQ6yVEVJJpT1ECLg1PEQPsZOEmEbpf4gxAkB/24iJyDmX53mWZUVRSCm11kMNEW29vswcQhBCFEXBOQcA55y1Flqcc8aYEMKmkVHvRynFGCvLMrRYa7XWvsW0xBi3ixExrMAVMUa8yhYxEXnvGWPGGGvt5kj+1b+17RhjCMEY07m11nZunXO7xEQEAFprRCSi7kN9IZulbrFdFEVZlnVdAwAiAsBBtonIWltVlVJKSum97zLvkF1fknrFcrnsZiaEGHa4/xQRXrctpVwsFoyxrGU2m83n867gbmzWJwhIlDBRaqIVIzZ6bUMlpFZKKa21ruvaGCOl7Gqp63rBLeNydn4+/vmH87I5Vb0r570QzUtSym43QwgAMOh204XxeHxy/HkymQzERK24gTG2o9XD5+vMfW/af8Plbu7pdltwyso0nUlRsiyfXzCe5fPpdFpVlTFmz6ia9cSEq2EM3e5OvrbtAYnwdw4fzszxD7fP8tUjqV0jPvulH7xbvvwo8AD1X0gLVm06bOlOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d9b44e7db92a6d6bad269353e42ab6be/81b7c/entry402-3.webp 158w,\n/static/d9b44e7db92a6d6bad269353e42ab6be/6ea66/entry402-3.webp 315w,\n/static/d9b44e7db92a6d6bad269353e42ab6be/abae2/entry402-3.webp 629w\"\n              sizes=\"(max-width: 629px) 100vw, 629px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d9b44e7db92a6d6bad269353e42ab6be/c26ae/entry402-3.png 158w,\n/static/d9b44e7db92a6d6bad269353e42ab6be/6bdcf/entry402-3.png 315w,\n/static/d9b44e7db92a6d6bad269353e42ab6be/63a68/entry402-3.png 629w\"\n            sizes=\"(max-width: 629px) 100vw, 629px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d9b44e7db92a6d6bad269353e42ab6be/63a68/entry402-3.png\"\n            alt=\"私はロボットではありません\"\n            title=\"私はロボットではありません\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>トークンを発行できます。<br>\nあとは実装するのみです！！！</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f3e062547e72ca488e1042524ae0e023/d0cc0/entry402-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVQoz5WS21LDMAwF8/8/CkNLfJFsSzqyzSSBNkBhpjt+8MvK0pEXM2NmAPN5ltbauq4xxpwzEbn7EzKAsnPIAMYv3P1ha4uZre/XsK6lsJk9fOEo8UB271SFqzaFe39uZrH+GvQtIVeHKUxFBICqAjCzWutfcS6Ac6mlSiC5BHm5UiISESJqOzFGETlHcErb5pWnYJLMIihNDkfk86KqfuKcy+J9ss4xt+Nw3R35jgPu3t17d5zl0TugMNsH3FDVY3lExMwiDd7Nh9ioOgSjj9uq4FvUYk2s1FpKSSnFGEMI607OSdSqODekglTtLjcbFxro03yqKjPnnHknf2Fb8rY1v21B7m3Pfdr/+fHhbvIHYyb8igjNwpoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f3e062547e72ca488e1042524ae0e023/81b7c/entry402-4.webp 158w,\n/static/f3e062547e72ca488e1042524ae0e023/6ea66/entry402-4.webp 315w,\n/static/f3e062547e72ca488e1042524ae0e023/8aab1/entry402-4.webp 630w,\n/static/f3e062547e72ca488e1042524ae0e023/a0372/entry402-4.webp 732w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f3e062547e72ca488e1042524ae0e023/c26ae/entry402-4.png 158w,\n/static/f3e062547e72ca488e1042524ae0e023/6bdcf/entry402-4.png 315w,\n/static/f3e062547e72ca488e1042524ae0e023/f058b/entry402-4.png 630w,\n/static/f3e062547e72ca488e1042524ae0e023/d0cc0/entry402-4.png 732w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f3e062547e72ca488e1042524ae0e023/f058b/entry402-4.png\"\n            alt=\"トークンを発行\"\n            title=\"トークンを発行\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>キーは「サイトキー」と「シークレットキー」の2つです。</p>\n<h3 id=\"view：html側の設定\">View：HTML側の設定</h3>\n<p>たとえば、formというIDのformタグをターゲットにしたい場合こんな感じ。\nexternal_form/contact_form.php以下にこちらを追記。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span> <span class=\"token attr-name\">method</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>post<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">action</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$view</span><span class=\"token operator\">-></span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'send'</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n// 省略\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>JSを追加します。<br>\nとりあえずFooter付近で大丈夫だと思います。<br>\nJSにはrender以降のパラメーター[サイトキー]にreCAPCHAで取得できるサイトキーを記述します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>script src<span class=\"token operator\">=</span><span class=\"token string\">\"https://www.google.com/recaptcha/api.js?render=[サイトキー]\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<p>続けてJSを追記します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>script<span class=\"token operator\">></span>\n  <span class=\"token keyword\">const</span> rc_form <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'form'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">//フォーム要素にイベントハンドラを設定</span>\n  rc_form<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onsubmit</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//デフォルトの動作（送信）を停止</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//トークンを取得</span>\n\n    grecaptcha<span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      grecaptcha<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[サイトキー]'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>action<span class=\"token operator\">:</span> <span class=\"token string\">'contact'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">token</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> token_input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//input 要素を生成</span>\n        token_input<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'hidden'</span><span class=\"token punctuation\">;</span>\n        token_input<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'g-recaptcha-response'</span><span class=\"token punctuation\">;</span>\n        token_input<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> token<span class=\"token punctuation\">;</span> <span class=\"token comment\">//トークンを値に設定</span>\n        rc_form<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>token_input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> action_input <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//input 要素を生成</span>\n        action_input<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'hidden'</span><span class=\"token punctuation\">;</span>\n        action_input<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'action'</span><span class=\"token punctuation\">;</span>\n        action_input<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">'contact'</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//アクション名を値に設定</span>\n        rc_form<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>action_input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        rc_form<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//フォームを送信</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<p>次はPHP側のコントローラーに記述します。[シークレットキー]には取得した値を入力します。<br>\n<code class=\"language-text\">$result->score</code>から取れるスコアレベルは０ ~ 1なのでその間で設定します。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">bID</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$bID</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// validation/form ヘルパーを呼び出し</span>\n    <span class=\"token variable\">$email</span> <span class=\"token operator\">=</span> <span class=\"token class-name static-context\">Core</span><span class=\"token operator\">::</span><span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'helper/validation/strings'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$recapcha</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 省略：フォームの上でいろんな設定</span>\n\n    <span class=\"token comment\">// reCAPCHA</span>\n    <span class=\"token variable\">$ch</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_URL</span><span class=\"token punctuation\">,</span><span class=\"token string double-quoted-string\">\"https://www.google.com/recaptcha/api/siteverify\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_POST</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_POSTFIELDS</span><span class=\"token punctuation\">,</span> <span class=\"token function\">http_build_query</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string single-quoted-string\">'secret'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'[シークレットキー]'</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">//シークレットキー</span>\n        <span class=\"token string single-quoted-string\">'response'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'g-recaptcha-response'</span> <span class=\"token punctuation\">]</span>  <span class=\"token comment\">//トークン</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">curl_setopt</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">CURLOPT_RETURNTRANSFER</span><span class=\"token punctuation\">,</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//転送を実行してレスポンスを $api_response に格納</span>\n    <span class=\"token variable\">$api_response</span> <span class=\"token operator\">=</span> <span class=\"token function\">curl_exec</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">//セッションを終了</span>\n    <span class=\"token function\">curl_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$ch</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//レスポンスの $json（JSON形式）をデコード</span>\n    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">json_decode</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$api_response</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ~ 省略：そのほかのバリデーションなどのコード</span>\n\n    <span class=\"token comment\">// $result->score が 0.6以下の時はメール送信を弾く</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$result</span><span class=\"token operator\">-></span><span class=\"token property\">success</span> <span class=\"token operator\">!=</span> <span class=\"token constant boolean\">true</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token variable\">$result</span><span class=\"token operator\">-></span><span class=\"token property\">action</span> <span class=\"token operator\">!=</span> <span class=\"token string single-quoted-string\">'contact'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token variable\">$result</span><span class=\"token operator\">-></span><span class=\"token property\">score</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$errormsg</span> <span class=\"token operator\">.=</span> <span class=\"token string single-quoted-string\">'この送信内容はセキュリティ上無効です。&lt;br>'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// ~ 省略：問題ない場合の処理</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"まとめ\">まとめ</h2>\n<p>あとは、スパムが来たらreCAPCHAの管理画面から監視できるようになります！！<br>\nほぼスパムメールは来なくなると思いますが、スパムのスコアレベルはご自身で調整してください。</p>\n<p>WPなどではcontact form 7などのプラグインを使えば一発で設定可能ですw</p>\n<p>せっかくの大切なあなたのコンテンツ、しっかり守ってあげてくださいね。<br>\nそして、最後までお読みいただきありがとうございました。</p>"}