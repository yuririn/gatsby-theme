{"expireTime":9007200880808517000,"key":"transformer-remark-markdown-html-b471ed9dab368f1985b00047e0ad3f93-gatsby-remark-imagesgatsby-remark-autolink-headersgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-smartypants-","val":"<h2 id=\"実例：商品登録などのカスタム投稿にスライドショーを追加するためにカスタムフィールドにメディアを追加\">実例：商品登録などのカスタム投稿にスライドショーを追加するためにカスタムフィールドにメディアを追加</h2>\n<p>普通の投稿（ブログ記事以外）で投稿の種類を増やせるのがWordPressの便利なところですよね？<br>\n今回はお仕事で<em>商品</em>という種類の投稿を作って、いくつか画像を登録して投稿ごとに商品のスライドショーを実装しなければなりませんでした。</p>\n<p>プラグイン・<a href=\"https://ja.wordpress.org/plugins/advanced-custom-fields/\">カスタムフィールドアドバンス</a>を利用すればカンタンなんでしょうけど「<em>テーマをインストールした瞬間から設定なしで使える</em>」状態を目指したかったので、カスタマイズすることになりました。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/879931a6f4f438cc5d56f8cf9f430357/c391c/entry400-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVQ4y51T227TQBD1b4B4pmruaYv4ieQncjESLYUKRBNXiPwe8EYl3gAFRGiTOHa8l3h9yUEz6UZJmr4w0tFZz67PXHbWefT4CWr1Y0aldoRqnXCMk2fPUTs6Qblax8FhEU8PDpkLxTIKpQoKJcsVHBbLqFTrKJbKcE7PzpHnOaSU0FqvoBSzVArff/zEcDjE1+trfPr8BVIqKLUNISXzm4sLON6HjyBL0wxpliPLcublcsl+CuYrg7k2iI1h/y7oDNlgMIDz9n0PymT464eYhALjQGAmNKazEL7vIwgCjCdTKL1AmqZIkuQejDEs6F1dwXl32QPpRzqGjBOGNhl0bPggI46RZRlnsotN/6vz13D6nrcujYpk3JW7a9a/uW/XFLjrujuCtPmA2ENmBal0132xLWiZbi0IQ+7fdDqFEBLzecS+KBLw/RmU1lyuFUzTBK12e0+GAOI45jFSd+MThgFkFCFNEt4jH7G95ZVgilZrj+Bmf8TC8I3/Gs/w7fcYo0BALszekilYu9PZn6EVViZFKDV8oTEKJCaRgoqTe3O491JsP9bIc+5hJCS/GHo9Qgh+KZtBrVFCL0/P4PT63roHuzNme0XRiVfreGsGbU/J+n0PzmWvxx/kXCwW6x+tEIuZjSE3Zn2O+ObmFn9GI/4mLafRbMJ1XXQ6nf9Ct9tlkEaj0cQ/QxYaehKzq2cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/879931a6f4f438cc5d56f8cf9f430357/81b7c/entry400-1.webp 158w,\n/static/879931a6f4f438cc5d56f8cf9f430357/6ea66/entry400-1.webp 315w,\n/static/879931a6f4f438cc5d56f8cf9f430357/8aab1/entry400-1.webp 630w,\n/static/879931a6f4f438cc5d56f8cf9f430357/b8cf5/entry400-1.webp 673w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/879931a6f4f438cc5d56f8cf9f430357/c26ae/entry400-1.png 158w,\n/static/879931a6f4f438cc5d56f8cf9f430357/6bdcf/entry400-1.png 315w,\n/static/879931a6f4f438cc5d56f8cf9f430357/f058b/entry400-1.png 630w,\n/static/879931a6f4f438cc5d56f8cf9f430357/c391c/entry400-1.png 673w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/879931a6f4f438cc5d56f8cf9f430357/f058b/entry400-1.png\"\n            alt=\"商品登録などのカスタム投稿にスライドショーを追加\"\n            title=\"商品登録などのカスタム投稿にスライドショーを追加\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>私が実際実装した内容に限りなく近い状態での実装方法をご紹介します。</p>\n<h3 id=\"カスタム投稿を新規で作成\">カスタム投稿を新規で作成</h3>\n<p>function.phpなどに<code class=\"language-text\">create_post_type</code>という関数を作って、新たにカスタム投稿を追加します。</p>\n<p><code class=\"language-text\">add_action()</code>は特定のアクションに対して指定した関数をフックさせる関数です。</p>\n<p>この場合（initなので）プラグインなどの初期化のタイミングに実行されます。</p>\n<p>今回はあくまで「カスタムフィールドにメディア（画像登録）を追加する方法」のご紹介なので、詳しい説明は割愛します。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">\n<span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'init'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'create_post_type'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">create_post_type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$supports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string single-quoted-string\">'title'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'editor'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'author'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string single-quoted-string\">'revisions'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">register_post_type</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string single-quoted-string\">'products'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// カスタム投稿名</span>\n        <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string single-quoted-string\">'label'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'商品'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 管理画面の左メニューに表示されるテキスト</span>\n            <span class=\"token string single-quoted-string\">'public'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'show_ui'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'show_in_menu'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'capability_type'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'post'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'rewrite'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'query_var'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'exclude_from_search'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'show_in_rest'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'rest_base'</span> <span class=\"token operator\">=></span> <span class=\"token string single-quoted-string\">'products'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string single-quoted-string\">'has_archive'</span> <span class=\"token operator\">=></span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// アーカイブを有効にするか否か</span>\n            <span class=\"token string single-quoted-string\">'menu_position'</span> <span class=\"token operator\">=></span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 管理画面上でどこに配置するか今回の場合は「投稿」の下に配置</span>\n            <span class=\"token string single-quoted-string\">'supports'</span> <span class=\"token operator\">=></span> <span class=\"token variable\">$supports</span> <span class=\"token comment\">// 投稿画面でどのmoduleを使うか的な設定</span>\n        <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>フックのタイミングは以下を参考にすると良いです。</p>\n<p><a href=\"https://wpdocs.osdn.jp/%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3_API/%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%95%E3%83%83%E3%82%AF%E4%B8%80%E8%A6%A7\">プラグイン API/アクションフック一覧</a></p>\n<h3 id=\"カスタム投稿の編集画面にメタボックスの追加\">カスタム投稿の編集画面にメタボックスの追加</h3>\n<p><code class=\"language-text\">add_meta_box()</code>関数を使って登録エリアを作ります。</p>\n<p>引数はこちらを参考にしてください。</p>\n<p><a href=\"https://wpdocs.osdn.jp/%E9%96%A2%E6%95%B0%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9/add_meta_box\">関数リファレンス/add meta box</a></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'admin_menu'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'add_custom_fields'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">add_custom_fields</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">add_meta_box</span><span class=\"token punctuation\">(</span>\n        <span class=\"token string single-quoted-string\">'product_sectionid'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//id(必須)</span>\n        <span class=\"token string single-quoted-string\">'商品画像の登録'</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//title(必須)</span>\n        <span class=\"token string single-quoted-string\">'product_custom_fields'</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//コールバック(必須)</span>\n        <span class=\"token string single-quoted-string\">'products'</span><span class=\"token comment\">//投稿の種類(必須、post、pageなど)</span>\n        <span class=\"token string single-quoted-string\">'advanced'</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 編集画面セクションが表示される部分(オプション)</span>\n        <span class=\"token string single-quoted-string\">'default'</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//優先順位</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">product_custom_fields</code>関数内に実際登録させる内容コードを書きます。<br>\n以下のような感じで出力されるようにします。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2015e26225d1a3448b8f3ce783263986/b04e4/entry400-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.18987341772152%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAX0lEQVQI14WMywqAIBRE/f/PbFEtTJR8ZM51QsGgRXhgGBjuPWrddoYQ2ai19gCgCHqXUuYBOFCHMX0cwoZPmdYnpnxTRAgIIT+B9Jvxr6x1r2i0PiMX7eji9dlnNOEDDZ3sgS/2doAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2015e26225d1a3448b8f3ce783263986/81b7c/entry400-2.webp 158w,\n/static/2015e26225d1a3448b8f3ce783263986/6ea66/entry400-2.webp 315w,\n/static/2015e26225d1a3448b8f3ce783263986/8aab1/entry400-2.webp 630w,\n/static/2015e26225d1a3448b8f3ce783263986/60055/entry400-2.webp 888w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2015e26225d1a3448b8f3ce783263986/c26ae/entry400-2.png 158w,\n/static/2015e26225d1a3448b8f3ce783263986/6bdcf/entry400-2.png 315w,\n/static/2015e26225d1a3448b8f3ce783263986/f058b/entry400-2.png 630w,\n/static/2015e26225d1a3448b8f3ce783263986/b04e4/entry400-2.png 888w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2015e26225d1a3448b8f3ce783263986/f058b/entry400-2.png\"\n            alt=\"カスタム投稿の編集画面にメタボックスの追加\"\n            title=\"カスタム投稿の編集画面にメタボックスの追加\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><strong>今回は画像名と画像を3つまで登録</strong>できるようにしてみます。</p>\n<p>実際のデータはフォームタグをhiddenで仕込んでおき、JSで動的に値を格納できるようにしておきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">function product_custom_fields() {\n    $product_image_name = array();\n    $product_image = arra();\n\n    // 3画像の格納\n    for ( $i=0; $i &lt; 3; $i++ ) {\n        $product_image_name[] = get_post_meta( $post->ID, 'product-image-name_'.$i, true );\n        $product_image[] = get_post_meta( $post->ID, 'product-image_'.$i, true );\n    }    //登録画面に出力\n?>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>table</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-table<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$i</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token delimiter important\">?></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-field<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span> <span class=\"token attr-name\">scope</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>画像名<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token delimiter important\">?></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>product-image-name_<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token function\">esc_html</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$product_image_name</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$product_image_name</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">''</span><span class=\"token punctuation\">)</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>tr</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>form-field<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>th</span> <span class=\"token attr-name\">scope</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>row<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>商品<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>th</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>td</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hidden<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>product-image_<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>product-image_<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$product_image</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$product_image</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-wrapper_<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$product_image</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token variable\">$product_thumb</span> <span class=\"token operator\">=</span> <span class=\"token function\">wp_get_attachment_image_src</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$product_image</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'thumbnail'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token delimiter important\">?></span></span>\n                        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$product_thumb</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$product_thumb</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$product_thumb</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>custom_media_image<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token punctuation\">}</span> <span class=\"token delimiter important\">?></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button button-secondary media_button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>media_button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>追加<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>media-button_<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>button button-secondary media_remove<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>media_remove<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">value</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>削除<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>media-remove_<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token delimiter important\">?></span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>td</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>tr</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endfor</span><span class=\"token punctuation\">;</span><span class=\"token delimiter important\">?></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>table</span><span class=\"token punctuation\">></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<h3 id=\"javascript-apiの呼び出し\">JavaScript APIの呼び出し</h3>\n<p>管理画面でメディアのJavaScript APIを利用してメディアのポップアップを呼び出せるようにします。</p>\n<p><code class=\"language-text\">wp_enqueue_media()</code>が無茶便利でした！</p>\n<p><a href=\"https://wpdocs.osdn.jp/%E9%96%A2%E6%95%B0%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9/wp_enqueue_media\">関数リファレンス/wp enqueue media</a></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'admin_enqueue_scripts'</span><span class=\"token punctuation\">,</span> add_api <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">add_api</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">wp_enqueue_media</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"javascript-apiの調整\">JavaScript APIの調整</h3>\n<p>編集画面にJavaScript APIを使って画像追加、削除ボタンから動的に画像を操作できるよう管理画面のfooter部分にJavaScriptを追加します。</p>\n<p>画像が選択されたら、JSで仕込んでおいたimgタグを表示するようにJavaScriptを仕込んでおきます。これでUI（見た目）もそこそこきれい。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/10c7d1e28d60f6b9e03b0b852ead8d81/f96df/entry400-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.06329113924051%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXUlEQVQoz5WRXUjTYRTGdxUVWBAIlhdiJZlYstBBhSaIF+mFpgVTcrBmrjZ1YurUNM20hKBIM1Kb9KEsKeyDRAMzwkwlnbkspI+L0FVLp32IMf/bfrH/dCTtpgcOhwPv++N5zpFMTllYWPiNWy6XSyzB4UAQHCwKAouLgrf/LRe+JZmx2RAEwQt0y263s2i3i7PD4RALl5Mpi4WBYROfTCa+jozwcmgIs3mMN69MvH834QHaZme9oOX+8/scZtMwg/3PxYfjY8O86HuKIktDfNxeGnbvpDkqnNjo7UhlEdRUlfLx7YD4X+KNsBTXrbkZK1fqLnH/2hm66jU8aixGniYnTamg90ENxgtFpByOJT5dRsy+XWh0OuZmLB7gMkgsp1METphNdNy9w4cnzVQlBtBYpiT1QCIH0zPoMGgxj7ZhuFzMKfV+DiXFcSxfz/S01e1qpUNxV8DttlaM59WYWjIxVit4bKxHIU9CtiealJQErl7Mpr4yiwp1KuocHfc6u/g2bfUV2ePwRkszHXXZPKxNYtCgpLf1HPm6bI5rtOyQRrLabz3B28IICA4lQ6ni9fgok1OTnqP42uHN6wZ6Ott51nmLhsqjVOh1HFGpKDiRhzQyCr91a4gI30pycgJarZr+vh4slil3Yt+R9QU61q6SELjRn81BAQRt2kCaXE5tdTnRUSHEyMKQSUMJCdmCf0AgTU2NWK2fcTqdK4HOpaMY29tRZWZSVJjP2cpSTp8spKy0mNrqCspLCsnRasnLzaVEX0xRoZ7u7m7mf/34F7gc2bYg8GVeYN7Bf+sP9cO7U214/m4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/10c7d1e28d60f6b9e03b0b852ead8d81/81b7c/entry400-3.webp 158w,\n/static/10c7d1e28d60f6b9e03b0b852ead8d81/6ea66/entry400-3.webp 315w,\n/static/10c7d1e28d60f6b9e03b0b852ead8d81/8aab1/entry400-3.webp 630w,\n/static/10c7d1e28d60f6b9e03b0b852ead8d81/51e4d/entry400-3.webp 849w\"\n              sizes=\"(max-width: 630px) 100vw, 630px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/10c7d1e28d60f6b9e03b0b852ead8d81/c26ae/entry400-3.png 158w,\n/static/10c7d1e28d60f6b9e03b0b852ead8d81/6bdcf/entry400-3.png 315w,\n/static/10c7d1e28d60f6b9e03b0b852ead8d81/f058b/entry400-3.png 630w,\n/static/10c7d1e28d60f6b9e03b0b852ead8d81/f96df/entry400-3.png 849w\"\n            sizes=\"(max-width: 630px) 100vw, 630px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/10c7d1e28d60f6b9e03b0b852ead8d81/f058b/entry400-3.png\"\n            alt=\"JavaScript APIの調整\"\n            title=\"JavaScript APIの調整\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\">add_action( 'admin_footer', array ( $this, 'add_script' ) );\n\npublic function add_script() {\n?>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n    <span class=\"token function\">jQuery</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">ready</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> _custom_media <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n            _orig_send_attachment <span class=\"token operator\">=</span> wp<span class=\"token punctuation\">.</span>media<span class=\"token punctuation\">.</span>editor<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">.</span>attachment<span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 画像の登録</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'.media_button'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">index</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token keyword\">let</span> send_attachment_bkp <span class=\"token operator\">=</span> wp<span class=\"token punctuation\">.</span>media<span class=\"token punctuation\">.</span>editor<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">.</span>attachment<span class=\"token punctuation\">;</span>\n                    wp<span class=\"token punctuation\">.</span>media<span class=\"token punctuation\">.</span>editor<span class=\"token punctuation\">.</span>send<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">attachment</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props<span class=\"token punctuation\">,</span> attachment</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> _custom_media <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#product-image_'</span><span class=\"token operator\">+</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span>attachment<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#image-wrapper_'</span><span class=\"token operator\">+</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">html</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;img class=\"custom_media_image\" src=\"'</span> <span class=\"token operator\">+</span> attachment<span class=\"token punctuation\">.</span>sizes<span class=\"token punctuation\">.</span>thumbnail<span class=\"token punctuation\">.</span>url <span class=\"token operator\">+</span> <span class=\"token string\">'\" height=\"'</span> <span class=\"token operator\">+</span> attachment<span class=\"token punctuation\">.</span>sizes<span class=\"token punctuation\">.</span>thumbnail<span class=\"token punctuation\">.</span>height <span class=\"token operator\">+</span> <span class=\"token string\">'\" width=\"'</span> <span class=\"token operator\">+</span> attachment<span class=\"token punctuation\">.</span>sizes<span class=\"token punctuation\">.</span>thumbnail<span class=\"token punctuation\">.</span>width <span class=\"token operator\">+</span> <span class=\"token string\">'\">'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token keyword\">return</span> <span class=\"token function\">_orig_send_attachment</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>props<span class=\"token punctuation\">,</span> attachment<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                        <span class=\"token punctuation\">}</span>\n                    <span class=\"token punctuation\">}</span>\n                    wp<span class=\"token punctuation\">.</span>media<span class=\"token punctuation\">.</span>editor<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// 削除</span>\n            <span class=\"token function\">$</span><span class=\"token punctuation\">(</span> <span class=\"token string\">'.media_remove'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">index</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#product-image_'</span><span class=\"token operator\">+</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">val</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#image-wrapper_'</span> <span class=\"token operator\">+</span> index <span class=\"token operator\">+</span> <span class=\"token string\">' .custom_media_image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>\n<h3 id=\"画像と画像名を保存\">画像と画像名を保存</h3>\n<p>画像と画像名を保存できるようにします。</p>\n<p><em>2021年1月13日追記</em></p>\n<p>サイトをリロードやプレビューへ切り替えた際にデータが消えるバグを発見しました。</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">add_action</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'save_post'</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'save_products'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function-definition function\">save_products</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 画像</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$i</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">++</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'product-image-name_'</span><span class=\"token operator\">.</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'product-image-name_'</span><span class=\"token operator\">.</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">update_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'product-image-name_'</span><span class=\"token operator\">.</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'product-image-name_'</span><span class=\"token operator\">.</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">delete_post_meta</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'product-image-name_'</span><span class=\"token operator\">.</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// 画像の保存</span>\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'product-image_'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'product-image_'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string single-quoted-string\">''</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">update_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'product-image_'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'product-image_'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token function\">delete_post_meta</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$post_id</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'product-image_'</span><span class=\"token operator\">.</span><span class=\"token variable\">$i</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"プラグインなしで実装するメリット\">プラグインなしで実装するメリット</h2>\n<p>ぶっちゃけWordPressってプラグインの方が安定してますしすべての機能を網羅していて痒いところに手が届きます。しかも無料です。</p>\n<p>しかし**「すべての機能」を網羅しているがゆえに不要な機能もたくさん付いています**。<br><br></p>\n<p>私のカスタマイズするメリットは以下のような感じです。</p>\n<ul>\n<li>サイトの軽量化プラグインを減らして不要なJSやCSSを抑え軽くすることができる</li>\n<li>余計な機能を減らすことでユーザーが迷わない<br><br></li>\n</ul>\n<p>利用するのはお客さん。</p>\n<p>ブログなのか、企業サイトなのかなどで何を強化するなどがまったく違ってきますのでニーズに合わせてカスタマイズするのがディベロッパーの使命かと思います^ ^。</p>\n<h2 id=\"まとめ\">まとめ</h2>\n<p>こんな感じで、画像がカスタム投稿でもリッチに登録できるようになりました！！</p>\n<p>工夫したらカテゴリーなどのサムネ登録などでも応用できます。</p>\n<p>みなさんのコーディングライフの一助となれば幸いです。<br><br></p>\n<p>最後までお読みいただきありがとうございました。</p>"}